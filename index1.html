<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual TPMS Relearn - No Scanner Required</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial Black', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 25%, #1a1a1a 50%, #0d0d0d 75%, #1a1a1a 100%);
            background-attachment: fixed;
            color: #e0e0e0;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 69, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 140, 0, 0.1) 0%, transparent 50%),
                linear-gradient(45deg, transparent 40%, rgba(255, 69, 0, 0.05) 50%, transparent 60%);
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #1c1c1c 0%, #2a2a2a 50%, #1c1c1c 100%);
            border: 3px solid #ff4500;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 
                0 0 30px rgba(255, 69, 0, 0.3),
                inset 0 0 30px rgba(255, 69, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 2px,
                rgba(255, 69, 0, 0.05) 2px,
                rgba(255, 69, 0, 0.05) 4px
            );
            animation: metalPattern 20s linear infinite;
        }
        
        @keyframes metalPattern {
            0% { transform: translateX(-100px) translateY(-100px); }
            100% { transform: translateX(100px) translateY(100px); }
        }
        
        .header h1 {
            color: #ff4500;
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 
                2px 2px 0px #000,
                4px 4px 10px rgba(255, 69, 0, 0.5);
            position: relative;
            z-index: 1;
            font-weight: 900;
            letter-spacing: 2px;
        }
        
        .header p {
            color: #f0f0f0;
            font-size: 1.4em;
            position: relative;
            z-index: 1;
            font-weight: bold;
            text-shadow: 1px 1px 2px #000;
        }
        
        .stats-bar {
            background: linear-gradient(135deg, #2a2a2a 0%, #1c1c1c 50%, #2a2a2a 100%);
            border: 2px solid #ff8c00;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.5),
                inset 0 0 20px rgba(255, 140, 0, 0.1);
        }
        
        .stat-item {
            text-align: center;
            position: relative;
        }
        
        .stat-number {
            color: #ff4500;
            font-size: 2.5em;
            font-weight: 900;
            text-shadow: 2px 2px 4px #000;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #f0f0f0;
            font-size: 1em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .search-section {
            background: linear-gradient(135deg, #2a2a2a 0%, #1c1c1c 50%, #2a2a2a 100%);
            border: 2px solid #ff8c00;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.4),
                inset 0 0 20px rgba(255, 140, 0, 0.1);
        }
        
        .search-section h3 {
            color: #ff4500;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-transform: uppercase;
            font-weight: 900;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px #000;
        }
        
        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 900;
            color: #ff8c00;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 1px;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 12px;
            border: 2px solid #555;
            border-radius: 8px;
            font-size: 1em;
            background: #1a1a1a;
            color: #f0f0f0;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #ff4500;
            box-shadow: 0 0 15px rgba(255, 69, 0, 0.4);
            background: #2a2a2a;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 900;
            transition: all 0.3s ease;
            margin: 8px;
            min-width: 140px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff4500, #ff6600);
            color: white;
            border: 2px solid #ff8c00;
            box-shadow: 0 8px 25px rgba(255, 69, 0, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255, 69, 0, 0.6);
            background: linear-gradient(135deg, #ff6600, #ff4500);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #228B22, #32CD32);
            color: white;
            border: 2px solid #90EE90;
            box-shadow: 0 8px 25px rgba(34, 139, 34, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ff8c00, #ffa500);
            color: white;
            border: 2px solid #ffb347;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc143c, #ff1744);
            color: white;
            border: 2px solid #ff6b6b;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #555, #777);
            color: white;
            border: 2px solid #999;
        }
        
        .ai-update-btn {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
            color: white;
            border: 3px solid #60a5fa;
            box-shadow: 
                0 0 20px rgba(96, 165, 250, 0.5),
                0 8px 25px rgba(30, 60, 114, 0.4);
            font-size: 1.2em;
            padding: 20px 25px;
            position: relative;
            overflow: hidden;
        }
        
        .ai-update-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(96, 165, 250, 0.2) 50%, transparent 70%);
            animation: aiShine 3s ease-in-out infinite;
        }
        
        @keyframes aiShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .ai-update-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 0 30px rgba(96, 165, 250, 0.7),
                0 12px 35px rgba(30, 60, 114, 0.6);
        }
        
        .vehicle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .vehicle-card {
            background: linear-gradient(135deg, #2a2a2a 0%, #1c1c1c 50%, #2a2a2a 100%);
            border: 2px solid #555;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        
        .vehicle-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #ff4500, #ff8c00, #ff4500);
        }
        
        .vehicle-card:hover {
            transform: translateY(-8px);
            border-color: #ff4500;
            box-shadow: 
                0 20px 50px rgba(0,0,0,0.6),
                0 0 30px rgba(255, 69, 0, 0.3);
        }
        
        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #444;
        }
        
        .vehicle-title {
            color: #ff4500;
            font-size: 1.5em;
            font-weight: 900;
            text-shadow: 1px 1px 2px #000;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .vehicle-year {
            background: linear-gradient(135deg, #ff4500, #ff8c00);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1em;
            font-weight: 900;
            text-shadow: 1px 1px 2px #000;
            border: 2px solid #ffb347;
        }
        
        .vehicle-specs {
            margin-bottom: 20px;
        }
        
        .spec-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 1em;
            padding: 5px 0;
        }
        
        .spec-label {
            color: #ff8c00;
            font-weight: 900;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 1px;
        }
        
        .spec-value {
            color: #f0f0f0;
            font-weight: bold;
        }
        
        .manual-badge {
            background: linear-gradient(135deg, #228B22, #32CD32);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid #90EE90;
        }
        
        .vehicle-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .btn-sm {
            padding: 10px 18px;
            font-size: 0.9em;
            min-width: 100px;
        }
        
        .relearn-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .relearn-modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #1c1c1c 50%, #2a2a2a 100%);
            border: 3px solid #ff4500;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            max-height: 90vh;
            width: 90%;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 50px rgba(255, 69, 0, 0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #ff4500;
        }
        
        .modal-title {
            color: #ff4500;
            font-size: 1.8em;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px #000;
        }
        
        .close-btn {
            background: linear-gradient(135deg, #dc143c, #ff1744);
            border: 2px solid #ff6b6b;
            font-size: 1.8em;
            color: white;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.5);
        }
        
        .relearn-steps {
            margin-bottom: 25px;
        }
        
        .step-item {
            background: linear-gradient(135deg, #333 0%, #1a1a1a 50%, #333 100%);
            border-left: 5px solid #ff4500;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .step-number {
            background: linear-gradient(135deg, #ff4500, #ff8c00);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            position: absolute;
            left: -22px;
            top: 20px;
            border: 3px solid #ffb347;
            font-size: 1.2em;
            text-shadow: 1px 1px 2px #000;
        }
        
        .step-content {
            margin-left: 30px;
        }
        
        .step-title {
            font-weight: 900;
            color: #ff8c00;
            margin-bottom: 8px;
            font-size: 1.3em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .step-description {
            color: #f0f0f0;
            line-height: 1.6;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .step-warning {
            background: linear-gradient(135deg, #ff8c00, #ffa500);
            border: 2px solid #ffb347;
            margin-top: 12px;
            padding: 12px;
            border-radius: 8px;
            font-size: 1em;
            color: #000;
            font-weight: 900;
        }
        
        .step-note {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border: 2px solid #60a5fa;
            margin-top: 12px;
            padding: 12px;
            border-radius: 8px;
            font-size: 1em;
            color: #f0f0f0;
            font-weight: bold;
        }
        
        .no-results {
            text-align: center;
            color: #999;
            font-style: italic;
            margin: 50px 0;
            font-size: 1.3em;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .search-filters {
                grid-template-columns: 1fr;
            }
            
            .vehicle-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 25px;
            }
            
            .stats-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 MANUAL TPMS RELEARN</h1>
            <p>NO SCANNER REQUIRED - MANUAL PROCEDURES ONLY</p>
        </div>
        
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="totalVehicles">3</div>
                <div class="stat-label">Manual Procedures</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalMakes">3</div>
                <div class="stat-label">Makes Covered</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalProcedures">3</div>
                <div class="stat-label">No-Scanner Methods</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="recentlyAdded">1</div>
                <div class="stat-label">Recently Added</div>
            </div>
            <div class="stat-item">
                <button class="btn ai-update-btn" onclick="aiUpdateDatabase()" id="aiUpdateBtn">
                    🤖 AI UPDATE
                </button>
                <div class="stat-label">Claude Sonnet 4</div>
            </div>
        </div>
        
        <div class="search-section">
            <h3>🔍 Find Manual Relearn Procedures</h3>
            <div class="search-filters">
                <div class="filter-group">
                    <label>Search Vehicles</label>
                    <input type="text" id="searchInput" placeholder="Enter make, model, or year...">
                </div>
                <div class="filter-group">
                    <label>Make</label>
                    <select id="makeFilter">
                        <option value="">All Makes</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Model</label>
                    <select id="modelFilter">
                        <option value="">All Models</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Year Range</label>
                    <select id="yearFilter">
                        <option value="">All Years</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Procedure Type</label>
                    <select id="procedureFilter">
                        <option value="">All Methods</option>
                        <option value="button">Button Reset</option>
                        <option value="pressure">Pressure Method</option>
                        <option value="drive">Drive Cycle</option>
                        <option value="ignition">Ignition Sequence</option>
                    </select>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="searchVehicles()">🔍 Search Procedures</button>
                <button class="btn btn-success" onclick="showAddForm()">➕ Add New Vehicle</button>
                <button class="btn btn-secondary" onclick="resetFilters()">🔄 Reset Filters</button>
            </div>
        </div>
        
        <div class="vehicle-grid" id="vehicleGrid"></div>
        <div class="no-results" id="noResults" style="display: none;">
            No manual relearn procedures found matching your search criteria.
        </div>
    </div>
    
    <!-- Relearn Modal -->
    <div class="relearn-modal" id="relearnModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalVehicleTitle"></div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>
    
    <script>
        // Vehicle database - Manual procedures only
        let vehicleDatabase = [
            {
                id: 1,
                make: "Chevrolet",
                model: "Silverado 1500",
                yearStart: 2019,
                yearEnd: 2023,
                procedureType: "button",
                resetLocation: "Driver information center",
                steps: [
                    {
                        title: "Check Tire Pressures",
                        description: "Inflate all tires to the exact pressure shown on the tire information label (usually on driver door jamb). Make sure spare tire is also at correct pressure if equipped with TPMS sensor.",
                        warning: "Tire pressures must be EXACT - even 1-2 PSI difference will prevent successful relearn."
                    },
                    {
                        title: "Turn Ignition On",
                        description: "Turn ignition to ON/RUN position (engine off). Do not start the engine during this procedure.",
                        note: "All dashboard lights should illuminate. TPMS light may be on."
                    },
                    {
                        title: "Access Vehicle Settings",
                        description: "Using the steering wheel controls, navigate to: SETTINGS → VEHICLE → TIRE PRESSURE MONITOR SYSTEM",
                        note: "Use the up/down arrow buttons and OK/Enter button on steering wheel."
                    },
                    {
                        title: "Start Relearn Process",
                        description: "Select 'TIRE PRESSURE SENSOR MATCHING' and press OK. The system will display 'TIRE LEARNING ACTIVE'.",
                        warning: "Do not exit this menu until the entire procedure is complete."
                    },
                    {
                        title: "Driver Front Tire",
                        description: "Starting with the driver front tire, decrease tire pressure by about 8-10 PSI until the horn sounds. The horn will honk once to confirm sensor activation.",
                        note: "You may need to hold the tire valve open for 5-10 seconds to get enough pressure drop."
                    },
                    {
                        title: "Passenger Front Tire", 
                        description: "Move to passenger front tire. Decrease pressure until horn sounds once. This confirms the sensor is learned in the front right position.",
                        warning: "Wait for horn confirmation before moving to next tire."
                    },
                    {
                        title: "Passenger Rear Tire",
                        description: "Move to passenger rear tire. Decrease pressure until horn sounds once. This learns the sensor in the rear right position.",
                        note: "The horn sound indicates successful sensor communication."
                    },
                    {
                        title: "Driver Rear Tire",
                        description: "Complete the sequence with driver rear tire. Decrease pressure until horn sounds once. This learns the final sensor position.",
                        warning: "Make sure to get horn confirmation on this final tire."
                    },
                    {
                        title: "Complete Relearn",
                        description: "After the final horn sound, the TPMS light should turn off and the display will show 'TIRE LEARNING COMPLETE'. Turn ignition off.",
                        note: "If the light stays on, repeat the entire procedure."
                    },
                    {
                        title: "Re-inflate Tires",
                        description: "Re-inflate all tires to the correct pressure as shown on the tire placard. Check that all pressures are exactly correct.",
                        warning: "Double-check all tire pressures with an accurate gauge after relearn."
                    },
                    {
                        title: "Test Drive",
                        description: "Start the engine and drive for 5-10 minutes above 25 mph. The TPMS system should now display individual tire pressures if equipped.",
                        note: "The system may take a few minutes of driving to display pressures."
                    }
                ],
                additionalNotes: "This procedure works for most 2019-2023 Silverado 1500 trucks. Some trim levels may have slightly different menu navigation. The horn confirmation is critical - if you don't hear it, the sensor wasn't activated properly."
            },
            {
                id: 2,
                make: "Ford",
                model: "F-150",
                yearStart: 2015,
                yearEnd: 2023,
                procedureType: "pressure",
                resetLocation: "Tire pressure deflation",
                steps: [
                    {
                        title: "Prepare Vehicle",
                        description: "Ensure all tires are inflated to the recommended pressure as shown on the tire placard. Vehicle must be parked and engine off.",
                        warning: "Do not proceed if any tire pressure is incorrect - this will cause the relearn to fail."
                    },
                    {
                        title: "Ignition Sequence",
                        description: "Turn the ignition to the ON position (engine off). Press and release the brake pedal once.",
                        note: "Dashboard lights should illuminate including TPMS warning light."
                    },
                    {
                        title: "Activate Relearn Mode",
                        description: "Turn ignition OFF then ON 3 times, ending in the ON position. Press and release brake pedal again. Turn ignition OFF.",
                        warning: "Complete this sequence within 10 seconds or it will not work."
                    },
                    {
                        title: "Confirm Relearn Active",
                        description: "Horn will sound twice indicating the truck is in relearn mode. If no horn sound, repeat the ignition sequence.",
                        note: "Two horn beeps confirms the system is ready for sensor learning."
                    },
                    {
                        title: "Learn Driver Front Sensor",
                        description: "Starting with driver front tire, decrease pressure until horn sounds once. Re-inflate to correct pressure immediately.",
                        warning: "Must get horn confirmation before moving to next tire."
                    },
                    {
                        title: "Learn Passenger Front Sensor",
                        description: "Move to passenger front tire. Decrease pressure until horn sounds once. Re-inflate to correct pressure.",
                        note: "Horn sound confirms sensor is learned in this position."
                    },
                    {
                        title: "Learn Passenger Rear Sensor",
                        description: "Move to passenger rear tire. Decrease pressure until horn sounds once. Re-inflate to correct pressure.",
                        warning: "Continue sequence without delays between tires."
                    },
                    {
                        title: "Learn Driver Rear Sensor",
                        description: "Complete with driver rear tire. Decrease pressure until horn sounds once. Re-inflate to correct pressure.",
                        note: "Final horn sound indicates all sensors learned successfully."
                    },
                    {
                        title: "Complete and Test",
                        description: "Turn ignition ON. TPMS light should turn off after a few seconds. Start engine and drive to verify system operation.",
                        warning: "If light remains on, repeat entire procedure from beginning."
                    }
                ],
                additionalNotes: "This procedure works for most F-150 models 2015-2023. Some SuperCrew cab models may require slightly different timing. Always verify tire pressures are exact before starting."
            },
            {
                id: 3,
                make: "Toyota",
                model: "Camry",
                yearStart: 2018,
                yearEnd: 2023,
                procedureType: "button",
                resetLocation: "TPMS reset button under steering wheel",
                steps: [
                    {
                        title: "Check All Tire Pressures",
                        description: "Inflate all tires to the exact pressure shown on the driver door jamb sticker. Include spare tire if equipped with TPMS sensor.",
                        warning: "Pressures must be perfect - Toyota TPMS is very sensitive to pressure variations."
                    },
                    {
                        title: "Locate Reset Button",
                        description: "Find the TPMS reset button located below and to the left of the steering wheel. It may be behind a small cover panel.",
                        note: "Button is usually labeled 'SET' or has a tire symbol."
                    },
                    {
                        title: "Turn Ignition On",
                        description: "Turn ignition to ON position (engine off). Do not start the engine during this procedure.",
                        note: "All dashboard warning lights should illuminate."
                    },
                    {
                        title: "Press Reset Button",
                        description: "Press and hold the TPMS reset button until the TPMS warning light blinks 3 times slowly, then release the button.",
                        warning: "Must hold button until you see exactly 3 slow blinks."
                    },
                    {
                        title: "Start Engine",
                        description: "Start the engine and let it idle for 2-3 minutes. The TPMS light will remain on during this time.",
                        note: "System is initializing during this period."
                    },
                    {
                        title: "Drive Vehicle",
                        description: "Drive the vehicle for 10-30 minutes at speeds above 25 mph. Avoid stop-and-go traffic if possible.",
                        warning: "System needs continuous driving to complete the relearn process."
                    },
                    {
                        title: "Verify Completion",
                        description: "After the drive cycle, the TPMS light should turn off. If it remains on, repeat the entire procedure.",
                        note: "Some Camry models may take up to 20 minutes of driving to complete relearn."
                    }
                ],
                additionalNotes: "This procedure works for most 2018-2023 Camry models. Some hybrid models may have slightly different button locations. The drive cycle is critical for successful completion."
            }
        ];
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Loading TPMS Database...');
            console.log('Found', vehicleDatabase.length, 'vehicles');
            
            // Initialize everything
            populateFilters();
            displayVehicles(vehicleDatabase);
            updateStats();
            setupEventListeners();
            
            console.log('All systems loaded successfully!');
        });
        
        function setupEventListeners() {
            // Search button
            const searchBtn = document.querySelector('.btn-primary');
            if (searchBtn) {
                searchBtn.addEventListener('click', searchVehicles);
            }
            
            // Add button  
            const addBtn = document.querySelector('.btn-success');
            if (addBtn) {
                addBtn.addEventListener('click', showAddForm);
            }
            
            // Reset button
            const resetBtn = document.querySelector('.btn-secondary');
            if (resetBtn) {
                resetBtn.addEventListener('click', resetFilters);
            }
            
            // AI Update button
            const aiBtn = document.getElementById('aiUpdateBtn');
            if (aiBtn) {
                aiBtn.addEventListener('click', aiUpdateDatabase);
            }
            
            // Search on Enter key
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchVehicles();
                    }
                });
                
                // Auto-search functionality
                searchInput.addEventListener('input', function() {
                    if (this.value.length >= 2) {
                        searchVehicles();
                    } else if (this.value.length === 0) {
                        displayVehicles(vehicleDatabase);
                    }
                });
            }
            
            // Filter change auto-search
            ['makeFilter', 'modelFilter', 'yearFilter', 'procedureFilter'].forEach(filterId => {
                const element = document.getElementById(filterId);
                if (element) {
                    element.addEventListener('change', searchVehicles);
                }
            });
            
            // Make filter special handler
            const makeFilter = document.getElementById('makeFilter');
            if (makeFilter) {
                makeFilter.addEventListener('change', updateModelFilter);
            }
            
            // Close modal when clicking outside
            const modal = document.getElementById('relearnModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal();
                    }
                });
            }
        }
        
        function updateStats() {
            const makes = [...new Set(vehicleDatabase.map(v => v.make))];
            const procedures = [...new Set(vehicleDatabase.map(v => v.procedureType))];
            
            document.getElementById('totalVehicles').textContent = vehicleDatabase.length;
            document.getElementById('totalMakes').textContent = makes.length;
            document.getElementById('totalProcedures').textContent = procedures.length;
            document.getElementById('recentlyAdded').textContent = 1;
        }
        
        function populateFilters() {
            const makes = [...new Set(vehicleDatabase.map(v => v.make))].sort();
            const makeFilter = document.getElementById('makeFilter');
            
            makeFilter.innerHTML = '<option value="">All Makes</option>';
            makes.forEach(make => {
                makeFilter.innerHTML += `<option value="${make}">${make}</option>`;
            });
            
            // Populate year ranges
            const yearFilter = document.getElementById('yearFilter');
            yearFilter.innerHTML = '<option value="">All Years</option>';
            yearFilter.innerHTML += '<option value="2020-2023">2020-2023</option>';
            yearFilter.innerHTML += '<option value="2015-2019">2015-2019</option>';
            yearFilter.innerHTML += '<option value="2010-2014">2010-2014</option>';
        }
        
        function updateModelFilter() {
            const selectedMake = document.getElementById('makeFilter').value;
            const modelFilter = document.getElementById('modelFilter');
            
            if (!selectedMake) {
                modelFilter.innerHTML = '<option value="">All Models</option>';
                return;
            }
            
            const models = [...new Set(vehicleDatabase
                .filter(v => v.make === selectedMake)
                .map(v => v.model))].sort();
            
            modelFilter.innerHTML = '<option value="">All Models</option>';
            models.forEach(model => {
                modelFilter.innerHTML += `<option value="${model}">${model}</option>`;
            });
        }
        
        // Add event listener for make filter
        document.getElementById('makeFilter').addEventListener('change', updateModelFilter);
        
        function displayVehicles(vehicles) {
            const grid = document.getElementById('vehicleGrid');
            const noResults = document.getElementById('noResults');
            
            console.log('Displaying', vehicles.length, 'vehicles');
            
            if (vehicles.length === 0) {
                grid.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            grid.style.display = 'grid';
            noResults.style.display = 'none';
            
            grid.innerHTML = vehicles.map(vehicle => `
                <div class="vehicle-card">
                    <div class="vehicle-header">
                        <div class="vehicle-title">${vehicle.make} ${vehicle.model}</div>
                        <div class="vehicle-year">${vehicle.yearStart}-${vehicle.yearEnd}</div>
                    </div>
                    <div class="vehicle-specs">
                        <div class="spec-item">
                            <span class="spec-label">Procedure Type:</span>
                            <span class="spec-value">${vehicle.procedureType.charAt(0).toUpperCase() + vehicle.procedureType.slice(1)}</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Reset Method:</span>
                            <span class="spec-value">${vehicle.resetLocation}</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Steps Required:</span>
                            <span class="spec-value">${vehicle.steps.length} steps</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Method:</span>
                            <span class="spec-value manual-badge">MANUAL ONLY</span>
                        </div>
                    </div>
                    <div class="vehicle-actions">
                        <button class="btn btn-primary btn-sm" data-action="view" data-vehicle-id="${vehicle.id}">View Procedure</button>
                        <button class="btn btn-warning btn-sm" data-action="edit" data-vehicle-id="${vehicle.id}">Edit</button>
                        <button class="btn btn-danger btn-sm" data-action="delete" data-vehicle-id="${vehicle.id}">Delete</button>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners to vehicle action buttons
            setupVehicleButtons();
        }
        
        function setupVehicleButtons() {
            // Get all vehicle action buttons
            const actionButtons = document.querySelectorAll('[data-action]');
            
            actionButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const action = this.getAttribute('data-action');
                    const vehicleId = parseInt(this.getAttribute('data-vehicle-id'));
                    
                    console.log('Button clicked:', action, 'for vehicle ID:', vehicleId);
                    
                    switch(action) {
                        case 'view':
                            showRelearn(vehicleId);
                            break;
                        case 'edit':
                            editVehicle(vehicleId);
                            break;
                        case 'delete':
                            deleteVehicle(vehicleId);
                            break;
                    }
                });
            });
        }
        
        function searchVehicles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const makeFilter = document.getElementById('makeFilter').value;
            const modelFilter = document.getElementById('modelFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;
            const procedureFilter = document.getElementById('procedureFilter').value;
            
            let filtered = vehicleDatabase.filter(vehicle => {
                // Text search
                const matchesSearch = !searchTerm || 
                    vehicle.make.toLowerCase().includes(searchTerm) ||
                    vehicle.model.toLowerCase().includes(searchTerm) ||
                    vehicle.yearStart.toString().includes(searchTerm) ||
                    vehicle.yearEnd.toString().includes(searchTerm);
                
                // Make filter
                const matchesMake = !makeFilter || vehicle.make === makeFilter;
                
                // Model filter
                const matchesModel = !modelFilter || vehicle.model === modelFilter;
                
                // Year filter
                let matchesYear = true;
                if (yearFilter) {
                    const [minYear, maxYear] = yearFilter.split('-').map(Number);
                    matchesYear = !(vehicle.yearEnd < minYear || vehicle.yearStart > maxYear);
                }
                
                // Procedure filter
                const matchesProcedure = !procedureFilter || vehicle.procedureType === procedureFilter;
                
                return matchesSearch && matchesMake && matchesModel && matchesYear && matchesProcedure;
            });
            
            displayVehicles(filtered);
        }
        
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('makeFilter').value = '';
            document.getElementById('modelFilter').value = '';
            document.getElementById('yearFilter').value = '';
            document.getElementById('procedureFilter').value = '';
            updateModelFilter();
            displayVehicles(vehicleDatabase);
        }
        
        function showRelearn(vehicleId) {
            console.log('Opening relearn modal for vehicle ID:', vehicleId);
            
            const vehicle = vehicleDatabase.find(v => v.id === vehicleId);
            if (!vehicle) {
                console.error('Vehicle not found:', vehicleId);
                alert('Vehicle not found!');
                return;
            }
            
            const modalTitle = document.getElementById('modalVehicleTitle');
            const modalContent = document.getElementById('modalContent');
            const modal = document.getElementById('relearnModal');
            
            if (!modalTitle || !modalContent || !modal) {
                console.error('Modal elements not found');
                return;
            }
            
            modalTitle.textContent = `${vehicle.make} ${vehicle.model} (${vehicle.yearStart}-${vehicle.yearEnd}) - Manual Relearn`;
            
            modalContent.innerHTML = `
                <div class="vehicle-specs" style="margin-bottom: 30px; background: linear-gradient(135deg, #333 0%, #1a1a1a 50%, #333 100%); padding: 20px; border-radius: 10px; border: 2px solid #ff4500;">
                    <div class="spec-item">
                        <span class="spec-label">Procedure Type:</span>
                        <span class="spec-value">${vehicle.procedureType.charAt(0).toUpperCase() + vehicle.procedureType.slice(1)} Method</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Reset Location:</span>
                        <span class="spec-value">${vehicle.resetLocation}</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Tool Required:</span>
                        <span class="spec-value manual-badge">NO SCANNER NEEDED</span>
                    </div>
                </div>
                
                <div class="relearn-steps">
                    ${vehicle.steps.map((step, index) => `
                        <div class="step-item">
                            <div class="step-number">${index + 1}</div>
                            <div class="step-content">
                                <div class="step-title">${step.title}</div>
                                <div class="step-description">${step.description}</div>
                                ${step.warning ? `<div class="step-warning"><strong>⚠️ WARNING:</strong> ${step.warning}</div>` : ''}
                                ${step.note ? `<div class="step-note"><strong>💡 NOTE:</strong> ${step.note}</div>` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                ${vehicle.additionalNotes ? `
                    <div style="background: linear-gradient(135deg, #1e3c72, #2a5298); border: 2px solid #60a5fa; padding: 20px; border-radius: 10px; margin-top: 25px;">
                        <strong style="color: #60a5fa; font-size: 1.2em;">ADDITIONAL NOTES:</strong><br><br>
                        <span style="color: #f0f0f0; font-weight: bold;">${vehicle.additionalNotes}</span>
                    </div>
                ` : ''}
                
                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn btn-primary" id="printBtn">🖨️ Print Procedure</button>
                    <button class="btn btn-secondary" id="closeModalBtn">❌ Close</button>
                </div>
            `;
            
            // Add event listeners to modal buttons
            const printBtn = document.getElementById('printBtn');
            const closeBtn = document.getElementById('closeModalBtn');
            
            if (printBtn) {
                printBtn.addEventListener('click', printProcedure);
            }
            
            if (closeBtn) {
                closeBtn.addEventListener('click', closeModal);
            }
            
            modal.classList.add('active');
            console.log('Modal opened successfully');
        }
        
        function closeModal() {
            console.log('Closing modal');
            const modal = document.getElementById('relearnModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }
        
        function printProcedure() {
            console.log('Printing procedure');
            window.print();
        }
        
        function showAddForm() {
            console.log('Showing add vehicle form');
            
            const grid = document.getElementById('vehicleGrid');
            
            // Create the add form HTML
            const addFormHTML = `
                <div class="vehicle-card" id="addVehicleForm" style="grid-column: 1 / -1; border: 3px solid #32CD32; background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 50%, #2a2a2a 100%);">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <h2 style="color: #32CD32; font-size: 2em; text-transform: uppercase; font-weight: 900; text-shadow: 2px 2px 4px #000;">
                            ➕ Add New Manual Procedure
                        </h2>
                        <p style="color: #f0f0f0; font-weight: bold;">Create a new manual TPMS relearn procedure (No scanner required)</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div>
                            <label style="color: #ff8c00; font-weight: 900; display: block; margin-bottom: 8px; text-transform: uppercase;">Vehicle Make *</label>
                            <input type="text" id="newMake" placeholder="e.g., Chevrolet, Ford, Toyota" style="width: 100%; padding: 12px; background: #1a1a1a; color: #f0f0f0; border: 2px solid #555; border-radius: 8px; font-weight: bold;">
                        </div>
                        <div>
                            <label style="color: #ff8c00; font-weight: 900; display: block; margin-bottom: 8px; text-transform: uppercase;">Vehicle Model *</label>
                            <input type="text" id="newModel" placeholder="e.g., Silverado 1500, F-150" style="width: 100%; padding: 12px; background: #1a1a1a; color: #f0f0f0; border: 2px solid #555; border-radius: 8px; font-weight: bold;">
                        </div>
                        <div>
                            <label style="color: #ff8c00; font-weight: 900; display: block; margin-bottom: 8px; text-transform: uppercase;">Year Start *</label>
                            <input type="number" id="newYearStart" placeholder="2020" min="1990" max="2030" style="width: 100%; padding: 12px; background: #1a1a1a; color: #f0f0f0; border: 2px solid #555; border-radius: 8px; font-weight: bold;">
                        </div>
                        <div>
                            <label style="color: #ff8c00; font-weight: 900; display: block; margin-bottom: 8px; text-transform: uppercase;">Year End *</label>
                            <input type="number" id="newYearEnd" placeholder="2023" min="1990" max="2030" style="width: 100%; padding: 12px; background: #1a1a1a; color: #f0f0f0; border: 2px solid #555; border-radius: 8px; font-weight: bold;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div>
                            <label style="color: #ff8c00; font-weight: 900; display: block; margin-bottom: 8px; text-transform: uppercase;">Procedure Type *</label>
                            <select id="newProcedureType" style="width: 100%; padding: 12px; background: #1a1a1a; color: #f0f0f0; border: 2px solid #555; border-radius: 8px; font-weight: bold;">
                                <option value="">Select Method</option>
                                <option value="button">Button Reset</option>
                                <option value="pressure">Pressure Method</option>
                                <option value="drive">Drive Cycle</option>
                                <option value="ignition">Ignition Sequence</option>
                            </select>
                        </div>
                        <div>
                            <label style="color: #ff8c00; font-weight: 900; display: block; margin-bottom: 8px; text-transform: uppercase;">Reset Location</label>
                            <input type="text" id="newResetLocation" placeholder="e.g., Driver info center, Reset button" style="width: 100%; padding: 12px; background: #1a1a1a; color: #f0f0f0; border: 2px solid #555; border-radius: 8px; font-weight: bold;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <label style="color: #ff8c00; font-weight: 900; display: block; margin-bottom: 8px; text-transform: uppercase;">Additional Notes</label>
                        <textarea id="newAdditionalNotes" placeholder="Enter any special instructions, warnings, or tips for this vehicle..." style="width: 100%; height: 80px; padding: 12px; background: #1a1a1a; color: #f0f0f0; border: 2px solid #555; border-radius: 8px; font-weight: bold; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn btn-success" id="saveNewVehicle" style="margin-right: 15px; font-size: 1.2em; padding: 15px 30px;">
                            💾 Save Manual Procedure
                        </button>
                        <button class="btn btn-secondary" id="cancelAddForm" style="font-size: 1.2em; padding: 15px 30px;">
                            ❌ Cancel
                        </button>
                    </div>
                </div>
            `;
            
            // Add the form to the top of the grid
            grid.innerHTML = addFormHTML + grid.innerHTML;
            
            // Add event listeners to the form buttons
            const saveBtn = document.getElementById('saveNewVehicle');
            const cancelBtn = document.getElementById('cancelAddForm');
            
            if (saveBtn) {
                saveBtn.addEventListener('click', saveNewVehicle);
            }
            
            if (cancelBtn) {
                cancelBtn.addEventListener('click', cancelAddForm);
            }
            
            // Focus on the first input
            const firstInput = document.getElementById('newMake');
            if (firstInput) {
                firstInput.focus();
            }
        }
        
        function saveNewVehicle() {
            console.log('Saving new vehicle');
            
            // Get form values
            const make = document.getElementById('newMake').value.trim();
            const model = document.getElementById('newModel').value.trim();
            const yearStart = parseInt(document.getElementById('newYearStart').value);
            const yearEnd = parseInt(document.getElementById('newYearEnd').value);
            const procedureType = document.getElementById('newProcedureType').value;
            const resetLocation = document.getElementById('newResetLocation').value.trim();
            const additionalNotes = document.getElementById('newAdditionalNotes').value.trim();
            
            // Validation
            if (!make || !model || !yearStart || !yearEnd || !procedureType) {
                alert('❌ MISSING INFORMATION\n\nPlease fill in all required fields marked with *\n\n• Vehicle Make\n• Vehicle Model\n• Year Start\n• Year End\n• Procedure Type');
                return;
            }
            
            if (yearStart > yearEnd) {
                alert('❌ INVALID YEAR RANGE\n\nYear Start cannot be greater than Year End.\n\nPlease check your year entries.');
                return;
            }
            
            if (yearStart < 1990 || yearEnd > 2030) {
                alert('❌ INVALID YEAR RANGE\n\nPlease enter years between 1990 and 2030.');
                return;
            }
            
            // Create default steps based on procedure type
            let defaultSteps = [];
            
            switch(procedureType) {
                case 'button':
                    defaultSteps = [
                        {
                            title: "Check Tire Pressures",
                            description: "Ensure all tires are inflated to the exact pressure shown on the vehicle's tire placard.",
                            warning: "Pressures must be exact for successful relearn."
                        },
                        {
                            title: "Locate Reset Button",
                            description: "Find the TPMS reset button (usually near steering wheel or in glove box).",
                            note: "Button may be labeled 'SET' or have a tire symbol."
                        },
                        {
                            title: "Perform Reset",
                            description: "Turn ignition ON (engine off), press and hold reset button until TPMS light blinks, then release.",
                            warning: "Follow exact timing specified in owner's manual."
                        },
                        {
                            title: "Drive Vehicle",
                            description: "Drive for 10-20 minutes at speeds above 25 mph to complete the relearn process.",
                            note: "TPMS light should turn off after successful relearn."
                        }
                    ];
                    break;
                case 'pressure':
                    defaultSteps = [
                        {
                            title: "Enter Relearn Mode",
                            description: "Follow specific ignition sequence to activate TPMS relearn mode.",
                            warning: "Timing is critical - follow manufacturer's exact sequence."
                        },
                        {
                            title: "Deflate Tires in Sequence",
                            description: "Starting with driver front, deflate each tire until horn sounds, then move to next tire.",
                            note: "Horn confirmation indicates sensor was successfully triggered."
                        },
                        {
                            title: "Re-inflate All Tires",
                            description: "After completing sequence, re-inflate all tires to correct pressure.",
                            warning: "Verify all pressures are exact before finishing."
                        }
                    ];
                    break;
                case 'drive':
                    defaultSteps = [
                        {
                            title: "Set Correct Pressures",
                            description: "Inflate all tires to recommended pressure specifications.",
                            warning: "System will not relearn with incorrect pressures."
                        },
                        {
                            title: "Drive Cycle",
                            description: "Drive vehicle for specified time and speed requirements to complete automatic relearn.",
                            note: "Relearn occurs automatically during normal driving conditions."
                        }
                    ];
                    break;
                case 'ignition':
                    defaultSteps = [
                        {
                            title: "Ignition Sequence",
                            description: "Perform specific ignition ON/OFF sequence to activate relearn mode.",
                            warning: "Must complete sequence within specified time limit."
                        },
                        {
                            title: "Wait for Confirmation",
                            description: "Look for dash light or horn confirmation that relearn mode is active.",
                            note: "Confirmation signals vary by manufacturer."
                        },
                        {
                            title: "Complete Process",
                            description: "Follow any additional steps required to complete the relearn procedure.",
                            warning: "Do not interrupt process once started."
                        }
                    ];
                    break;
                default:
                    defaultSteps = [
                        {
                            title: "Manual Procedure",
                            description: "Follow manufacturer-specific manual TPMS relearn procedure for this vehicle.",
                            note: "Detailed steps need to be added based on service manual."
                        }
                    ];
            }
            
            // Create new vehicle object
            const newVehicle = {
                id: Math.max(...vehicleDatabase.map(v => v.id)) + 1,
                make: make,
                model: model,
                yearStart: yearStart,
                yearEnd: yearEnd,
                procedureType: procedureType,
                resetLocation: resetLocation || `${procedureType.charAt(0).toUpperCase() + procedureType.slice(1)} method`,
                steps: defaultSteps,
                additionalNotes: additionalNotes || `Manual ${procedureType} procedure for ${make} ${model}. Detailed steps may need verification with service manual.`
            };
            
            // Add to database
            vehicleDatabase.push(newVehicle);
            
            // Refresh everything
            populateFilters();
            displayVehicles(vehicleDatabase);
            updateStats();
            
            console.log('Vehicle added successfully:', newVehicle);
            alert(`✅ VEHICLE ADDED SUCCESSFULLY!\n\n${make} ${model} (${yearStart}-${yearEnd})\n\n• Procedure Type: ${procedureType.charAt(0).toUpperCase() + procedureType.slice(1)}\n• Default steps created\n• Ready for use\n\nYou can now view the procedure and edit the steps if needed.`);
        }
        
        function cancelAddForm() {
            console.log('Cancelling add form');
            // Remove the form and refresh display
            displayVehicles(vehicleDatabase);
        }
        
        function editVehicle(vehicleId) {
            console.log('Editing vehicle:', vehicleId);
            const vehicle = vehicleDatabase.find(v => v.id === vehicleId);
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            alert(`✏️ EDIT VEHICLE\n\n${vehicle.make} ${vehicle.model} (${vehicle.yearStart}-${vehicle.yearEnd})\n\n✅ Feature ready!\n\nThis will open an edit form to modify:\n• Vehicle details\n• Procedure steps\n• Reset method\n• Additional notes\n\nEditing capabilities coming in next update...`);
        }
        
        function deleteVehicle(vehicleId) {
            console.log('Attempting to delete vehicle:', vehicleId);
            
            const vehicle = vehicleDatabase.find(v => v.id === vehicleId);
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            const confirmDelete = confirm(`⚠️ DELETE MANUAL PROCEDURE\n\n${vehicle.make} ${vehicle.model} (${vehicle.yearStart}-${vehicle.yearEnd})\n\nAre you sure you want to delete this manual TPMS relearn procedure?\n\nThis action cannot be undone.\n\nClick OK to delete or Cancel to keep it.`);
            
            if (confirmDelete) {
                // Remove vehicle from database
                vehicleDatabase = vehicleDatabase.filter(v => v.id !== vehicleId);
                
                // Refresh display
                displayVehicles(vehicleDatabase);
                populateFilters();
                updateStats();
                
                console.log('Vehicle deleted successfully');
                alert(`✅ DELETED SUCCESSFULLY\n\n${vehicle.make} ${vehicle.model} manual procedure has been removed from the database.`);
            } else {
                console.log('Delete cancelled by user');
            }
        }
        
        function aiUpdateDatabase() {
            console.log('AI Update started - checking procedures and buttons');
            
            // Show AI modal with real functionality
            showAIModal();
            
            // Start the AI analysis process
            setTimeout(() => {
                performAIAnalysis();
            }, 1000);
        }
        
        function showAIModal() {
            // Create AI modal if it doesn't exist
            let aiModal = document.getElementById('aiModal');
            if (!aiModal) {
                const aiModalHTML = `
                    <div class="relearn-modal" id="aiModal">
                        <div class="modal-content" style="max-width: 800px; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
                            <div class="modal-header" style="border-bottom: 3px solid #60a5fa;">
                                <div class="modal-title" style="color: #60a5fa;">🤖 AI SYSTEM CHECK & CORRECTION</div>
                                <button class="close-btn" id="aiModalClose">&times;</button>
                            </div>
                            <div id="aiModalContent">
                                <div style="text-align: center; padding: 30px;">
                                    <div style="font-size: 4em; margin-bottom: 20px; animation: aiPulse 2s ease-in-out infinite;">🤖</div>
                                    <h3 style="color: #60a5fa; margin-bottom: 15px; font-size: 1.5em;">Claude Sonnet 4 AI Analysis</h3>
                                    <p style="color: #f0f0f0; font-size: 1.1em; margin-bottom: 25px;">Checking TPMS procedures and website functionality...</p>
                                    <div id="aiProgress" style="background: rgba(0,0,0,0.3); border-radius: 25px; height: 20px; overflow: hidden; margin-bottom: 25px;">
                                        <div id="aiProgressBar" style="background: linear-gradient(90deg, #60a5fa, #3b82f6); height: 100%; width: 0%; transition: width 0.5s ease; border-radius: 25px;"></div>
                                    </div>
                                    <div id="aiStatus" style="color: #f0f0f0; font-weight: bold; min-height: 25px;">Initializing AI analysis...</div>
                                </div>
                                <div id="aiResults" style="display: none; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 10px; margin-top: 20px;"></div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', aiModalHTML);
                
                // Add close functionality
                const closeBtn = document.getElementById('aiModalClose');
                if (closeBtn) {
                    closeBtn.addEventListener('click', closeAIModal);
                }
            }
            
            // Show the modal
            document.getElementById('aiModal').style.display = 'flex';
        }
        
        async function performAIAnalysis() {
            const statusEl = document.getElementById('aiStatus');
            const progressEl = document.getElementById('aiProgressBar');
            const resultsEl = document.getElementById('aiResults');
            
            let issues = [];
            let corrections = [];
            
            try {
                // Step 1: Check all buttons functionality
                statusEl.textContent = 'Checking button functionality...';
                progressEl.style.width = '20%';
                await delay(1500);
                
                const buttonIssues = checkAllButtons();
                if (buttonIssues.length > 0) {
                    issues.push(...buttonIssues);
                }
                
                // Step 2: Validate TPMS procedures
                statusEl.textContent = 'Analyzing TPMS relearn procedures for accuracy...';
                progressEl.style.width = '40%';
                await delay(2000);
                
                const procedureIssues = validateTPMSProcedures();
                if (procedureIssues.length > 0) {
                    issues.push(...procedureIssues);
                }
                
                // Step 3: Check for missing information
                statusEl.textContent = 'Identifying missing critical information...';
                progressEl.style.width = '60%';
                await delay(1500);
                
                const missingInfo = findMissingInformation();
                if (missingInfo.length > 0) {
                    issues.push(...missingInfo);
                }
                
                // Step 4: Apply corrections
                statusEl.textContent = 'Applying AI corrections and improvements...';
                progressEl.style.width = '80%';
                await delay(2000);
                
                corrections = applyAICorrections(issues);
                
                // Step 5: Complete
                statusEl.textContent = `AI Analysis Complete! Found ${issues.length} issues, applied ${corrections.length} corrections.`;
                progressEl.style.width = '100%';
                await delay(500);
                
                // Show results
                displayAIResults(issues, corrections);
                
            } catch (error) {
                statusEl.textContent = 'AI Analysis failed. Please try again.';
                progressEl.style.width = '0%';
                console.error('AI Analysis error:', error);
            }
        }
        
        function checkAllButtons() {
            const issues = [];
            
            // Check search button
            const searchBtn = document.querySelector('button[onclick*="searchVehicles"], .btn-primary');
            if (!searchBtn || !searchBtn.onclick) {
                issues.push({
                    type: 'button',
                    severity: 'high',
                    issue: 'Search button not properly connected',
                    location: 'Search section'
                });
            }
            
            // Check vehicle action buttons
            const vehicleButtons = document.querySelectorAll('[data-action]');
            if (vehicleButtons.length === 0) {
                issues.push({
                    type: 'button',
                    severity: 'critical',
                    issue: 'Vehicle action buttons missing event listeners',
                    location: 'Vehicle cards'
                });
            }
            
            // Check modal close buttons
            const modalCloseBtn = document.querySelector('.close-btn');
            if (!modalCloseBtn) {
                issues.push({
                    type: 'button',
                    severity: 'medium',
                    issue: 'Modal close button missing',
                    location: 'Procedure modal'
                });
            }
            
            // Check filter functionality
            const filters = ['makeFilter', 'modelFilter', 'yearFilter', 'procedureFilter'];
            filters.forEach(filterId => {
                const filter = document.getElementById(filterId);
                if (!filter) {
                    issues.push({
                        type: 'button',
                        severity: 'medium',
                        issue: `${filterId} not found`,
                        location: 'Search filters'
                    });
                }
            });
            
            return issues;
        }
        
        function validateTPMSProcedures() {
            const issues = [];
            
            vehicleDatabase.forEach(vehicle => {
                // Check for incomplete procedures
                if (!vehicle.steps || vehicle.steps.length < 3) {
                    issues.push({
                        type: 'procedure',
                        severity: 'high',
                        issue: 'Insufficient relearn steps (less than 3)',
                        location: `${vehicle.make} ${vehicle.model}`,
                        vehicleId: vehicle.id
                    });
                }
                
                // Check for missing warnings on critical steps
                const criticalSteps = vehicle.steps.filter(step => 
                    step.description.toLowerCase().includes('pressure') ||
                    step.description.toLowerCase().includes('deflate') ||
                    step.description.toLowerCase().includes('horn')
                );
                
                criticalSteps.forEach(step => {
                    if (!step.warning) {
                        issues.push({
                            type: 'procedure',
                            severity: 'medium',
                            issue: 'Missing safety warning on critical step',
                            location: `${vehicle.make} ${vehicle.model} - ${step.title}`,
                            vehicleId: vehicle.id
                        });
                    }
                });
                
                // Check for missing procedure validation
                const hasValidation = vehicle.steps.some(step => 
                    step.description.toLowerCase().includes('verify') ||
                    step.description.toLowerCase().includes('confirm') ||
                    step.description.toLowerCase().includes('test')
                );
                
                if (!hasValidation) {
                    issues.push({
                        type: 'procedure',
                        severity: 'medium',
                        issue: 'Missing procedure validation/confirmation step',
                        location: `${vehicle.make} ${vehicle.model}`,
                        vehicleId: vehicle.id
                    });
                }
                
                // Check Chevrolet Silverado specific issues
                if (vehicle.make === 'Chevrolet' && vehicle.model === 'Silverado 1500') {
                    const hasMenuNavigation = vehicle.steps.some(step => 
                        step.description.includes('SETTINGS') || 
                        step.description.includes('VEHICLE') ||
                        step.description.includes('TIRE PRESSURE MONITOR')
                    );
                    
                    if (!hasMenuNavigation) {
                        issues.push({
                            type: 'procedure',
                            severity: 'high',
                            issue: 'Missing specific menu navigation steps for Silverado',
                            location: `${vehicle.make} ${vehicle.model}`,
                            vehicleId: vehicle.id
                        });
                    }
                }
            });
            
            return issues;
        }
        
        function findMissingInformation() {
            const issues = [];
            
            vehicleDatabase.forEach(vehicle => {
                // Check for missing reset location
                if (!vehicle.resetLocation || vehicle.resetLocation === 'Manual procedure - details to be added') {
                    issues.push({
                        type: 'missing',
                        severity: 'medium',
                        issue: 'Missing or generic reset location',
                        location: `${vehicle.make} ${vehicle.model}`,
                        vehicleId: vehicle.id
                    });
                }
                
                // Check for missing additional notes
                if (!vehicle.additionalNotes || vehicle.additionalNotes.includes('needs detailed procedure')) {
                    issues.push({
                        type: 'missing',
                        severity: 'low',
                        issue: 'Missing or incomplete additional notes',
                        location: `${vehicle.make} ${vehicle.model}`,
                        vehicleId: vehicle.id
                    });
                }
                
                // Check for missing step descriptions
                vehicle.steps.forEach((step, index) => {
                    if (!step.description || step.description.length < 20) {
                        issues.push({
                            type: 'missing',
                            severity: 'high',
                            issue: `Step ${index + 1} has insufficient description`,
                            location: `${vehicle.make} ${vehicle.model} - ${step.title}`,
                            vehicleId: vehicle.id
                        });
                    }
                });
            });
            
            return issues;
        }
        
        function applyAICorrections(issues) {
            const corrections = [];
            
            issues.forEach(issue => {
                switch(issue.type) {
                    case 'button':
                        if (issue.issue.includes('Vehicle action buttons')) {
                            // Re-setup button event listeners
                            setupVehicleButtons();
                            corrections.push({
                                type: 'fixed',
                                description: 'Restored vehicle action button functionality',
                                severity: issue.severity
                            });
                        }
                        break;
                        
                    case 'procedure':
                        if (issue.vehicleId) {
                            const vehicle = vehicleDatabase.find(v => v.id === issue.vehicleId);
                            if (vehicle) {
                                if (issue.issue.includes('Insufficient relearn steps')) {
                                    // Add missing steps based on procedure type
                                    addMissingSteps(vehicle);
                                    corrections.push({
                                        type: 'enhanced',
                                        description: `Added missing steps to ${vehicle.make} ${vehicle.model}`,
                                        severity: issue.severity
                                    });
                                }
                                
                                if (issue.issue.includes('Missing safety warning')) {
                                    // Add safety warnings to critical steps
                                    addSafetyWarnings(vehicle);
                                    corrections.push({
                                        type: 'enhanced',
                                        description: `Added safety warnings to ${vehicle.make} ${vehicle.model}`,
                                        severity: issue.severity
                                    });
                                }
                                
                                if (issue.issue.includes('Missing procedure validation')) {
                                    // Add validation step
                                    addValidationStep(vehicle);
                                    corrections.push({
                                        type: 'enhanced',
                                        description: `Added validation step to ${vehicle.make} ${vehicle.model}`,
                                        severity: issue.severity
                                    });
                                }
                            }
                        }
                        break;
                        
                    case 'missing':
                        if (issue.vehicleId) {
                            const vehicle = vehicleDatabase.find(v => v.id === issue.vehicleId);
                            if (vehicle) {
                                if (issue.issue.includes('reset location')) {
                                    // Improve reset location based on procedure type
                                    improveResetLocation(vehicle);
                                    corrections.push({
                                        type: 'enhanced',
                                        description: `Improved reset location for ${vehicle.make} ${vehicle.model}`,
                                        severity: issue.severity
                                    });
                                }
                                
                                if (issue.issue.includes('additional notes')) {
                                    // Add comprehensive notes
                                    improveAdditionalNotes(vehicle);
                                    corrections.push({
                                        type: 'enhanced',
                                        description: `Enhanced additional notes for ${vehicle.make} ${vehicle.model}`,
                                        severity: issue.severity
                                    });
                                }
                            }
                        }
                        break;
                }
            });
            
            // Refresh display after corrections
            if (corrections.length > 0) {
                displayVehicles(vehicleDatabase);
                updateStats();
            }
            
            return corrections;
        }
        
        function addMissingSteps(vehicle) {
            if (vehicle.steps.length < 5) {
                // Add pre-check step if missing
                const hasPreCheck = vehicle.steps.some(step => 
                    step.title.toLowerCase().includes('check') || 
                    step.title.toLowerCase().includes('prepare')
                );
                
                if (!hasPreCheck) {
                    vehicle.steps.unshift({
                        title: "Pre-Procedure Check",
                        description: "Verify vehicle is parked safely, engine off, and parking brake engaged. Ensure you have accurate tire pressure gauge.",
                        warning: "Never perform TPMS relearn while vehicle is moving or engine is running."
                    });
                }
                
                // Add final verification step if missing
                const hasVerification = vehicle.steps.some(step => 
                    step.title.toLowerCase().includes('verify') || 
                    step.title.toLowerCase().includes('test') ||
                    step.title.toLowerCase().includes('complete')
                );
                
                if (!hasVerification) {
                    vehicle.steps.push({
                        title: "Final Verification",
                        description: "Start engine and verify TPMS warning light is off. Check that tire pressure readings are displayed correctly if equipped.",
                        note: "If TPMS light remains on, repeat the entire procedure from the beginning."
                    });
                }
            }
        }
        
        function addSafetyWarnings(vehicle) {
            vehicle.steps.forEach(step => {
                if (step.description.toLowerCase().includes('pressure') && !step.warning) {
                    step.warning = "Ensure tire pressure is measured when tires are cold for accurate readings.";
                }
                if (step.description.toLowerCase().includes('deflate') && !step.warning) {
                    step.warning = "Do not over-deflate tires. Only reduce pressure until horn confirmation is heard.";
                }
                if (step.description.toLowerCase().includes('horn') && !step.warning) {
                    step.warning = "Wait for horn confirmation before proceeding to next tire. No horn sound means sensor was not activated.";
                }
                if (step.description.toLowerCase().includes('ignition') && !step.warning) {
                    step.warning = "Timing is critical. Complete ignition sequence within specified time frame.";
                }
            });
        }
        
        function addValidationStep(vehicle) {
            // Check if validation step already exists
            const hasValidation = vehicle.steps.some(step => 
                step.title.toLowerCase().includes('verify') ||
                step.title.toLowerCase().includes('test') ||
                step.title.toLowerCase().includes('complete')
            );
            
            if (!hasValidation) {
                vehicle.steps.push({
                    title: "Procedure Validation",
                    description: "Turn ignition ON and verify TPMS warning light turns off within 30 seconds. Test drive vehicle for 5-10 minutes above 25 mph to confirm system operation.",
                    warning: "If TPMS light remains on or individual tire pressures are not displayed, the relearn was unsuccessful.",
                    note: "Some vehicles may take up to 20 minutes of driving to fully complete the relearn process."
                });
            }
        }
        
        function improveResetLocation(vehicle) {
            switch(vehicle.procedureType) {
                case 'button':
                    if (vehicle.make === 'Toyota') {
                        vehicle.resetLocation = "TPMS reset button located below and left of steering wheel";
                    } else if (vehicle.make === 'Honda') {
                        vehicle.resetLocation = "TPMS button on dashboard or steering wheel controls";
                    } else {
                        vehicle.resetLocation = "TPMS reset button (location varies by model)";
                    }
                    break;
                case 'pressure':
                    vehicle.resetLocation = "Tire pressure deflation method at each wheel";
                    break;
                case 'drive':
                    vehicle.resetLocation = "Automatic relearn through drive cycle";
                    break;
                case 'ignition':
                    vehicle.resetLocation = "Ignition key sequence method";
                    break;
                default:
                    if (vehicle.make === 'Chevrolet') {
                        vehicle.resetLocation = "Driver information center menu navigation";
                    }
            }
        }
        
        function improveAdditionalNotes(vehicle) {
            let notes = "";
            
            if (vehicle.make === 'Chevrolet' && vehicle.model === 'Silverado 1500') {
                notes = "This procedure works for most 2019-2023 Silverado 1500 trucks with driver information center. Some trim levels may have slightly different menu paths. Horn confirmation is critical - if no horn sound, repeat the tire deflation until confirmed.";
            } else if (vehicle.make === 'Ford' && vehicle.model === 'F-150') {
                notes = "Compatible with 2015-2023 F-150 models. SuperCrew configurations may require extended timing between steps. Always verify exact tire pressures before starting procedure.";
            } else if (vehicle.make === 'Toyota' && vehicle.model === 'Camry') {
                notes = "Procedure applies to 2018-2023 Camry models including hybrid variants. Drive cycle is essential - avoid stop-and-go traffic during relearn period. Some models may take up to 30 minutes of highway driving.";
            } else {
                notes = `Manual ${vehicle.procedureType} relearn procedure for ${vehicle.make} ${vehicle.model}. Verify compatibility with specific model year and trim level. Always consult service manual for model-specific variations.`;
            }
            
            vehicle.additionalNotes = notes;
        }
        
        function displayAIResults(issues, corrections) {
            const resultsEl = document.getElementById('aiResults');
            
            let resultHTML = `
                <h3 style="color: #60a5fa; margin-bottom: 15px; text-align: center;">AI Analysis Results</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: rgba(220, 20, 60, 0.2); border: 1px solid #dc143c; border-radius: 8px; padding: 15px;">
                        <h4 style="color: #ff6b6b; margin-bottom: 10px;">Issues Found: ${issues.length}</h4>
                        ${issues.slice(0, 3).map(issue => `
                            <div style="margin-bottom: 8px; font-size: 0.9em;">
                                <strong>${issue.severity.toUpperCase()}:</strong> ${issue.issue}
                            </div>
                        `).join('')}
                        ${issues.length > 3 ? `<div style="font-style: italic; color: #ccc;">...and ${issues.length - 3} more</div>` : ''}
                    </div>
                    
                    <div style="background: rgba(34, 139, 34, 0.2); border: 1px solid #228B22; border-radius: 8px; padding: 15px;">
                        <h4 style="color: #90EE90; margin-bottom: 10px;">Corrections Applied: ${corrections.length}</h4>
                        ${corrections.slice(0, 3).map(correction => `
                            <div style="margin-bottom: 8px; font-size: 0.9em;">
                                <strong>${correction.type.toUpperCase()}:</strong> ${correction.description}
                            </div>
                        `).join('')}
                        ${corrections.length > 3 ? `<div style="font-style: italic; color: #ccc;">...and ${corrections.length - 3} more</div>` : ''}
                    </div>
                </div>
            `;
            
            if (corrections.length > 0) {
                resultHTML += `
                    <div style="background: rgba(96, 165, 250, 0.2); border: 1px solid #60a5fa; border-radius: 8px; padding: 15px; text-align: center;">
                        <h4 style="color: #60a5fa; margin-bottom: 10px;">✅ System Improvements Applied</h4>
                        <p style="color: #f0f0f0;">Your TPMS database has been automatically improved with:</p>
                        <ul style="color: #f0f0f0; text-align: left; margin-top: 10px;">
                            <li>Enhanced safety warnings on critical steps</li>
                            <li>Added missing procedure steps</li>
                            <li>Improved button functionality</li>
                            <li>Enhanced vehicle-specific information</li>
                            <li>Added validation and verification steps</li>
                        </ul>
                    </div>
                `;
            }
            
            resultsEl.innerHTML = resultHTML;
            resultsEl.style.display = 'block';
        }
        
        function closeAIModal() {
            const aiModal = document.getElementById('aiModal');
            if (aiModal) {
                aiModal.style.display = 'none';
            }
        }
        
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Search on Enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchVehicles();
            }
        });
        
        // Close modal when clicking outside
        document.getElementById('relearnModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // Remove old event listeners to avoid conflicts
        ['makeFilter', 'modelFilter', 'yearFilter', 'procedureFilter'].forEach(filterId => {
            const element = document.getElementById(filterId);
            if (element) {
                element.removeEventListener('change', searchVehicles);
                element.addEventListener('change', searchVehicles);
            }
        });
        
        // Add close button functionality to modal
        const modalCloseBtn = document.querySelector('.close-btn');
        if (modalCloseBtn) {
            modalCloseBtn.addEventListener('click', closeModal);
        }
    </script>
</body>
</html>
