<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced TPMS Diagnostics - Expert Level</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c1426 0%, #1a2332 25%, #2d3748 50%, #1a2332 75%, #0c1426 100%);
            color: #e2e8f0;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #475569;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .header h1 {
            color: #3b82f6;
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            position: relative;
            z-index: 1;
        }
        
        .header p {
            color: #94a3b8;
            font-size: 1.3em;
            position: relative;
            z-index: 1;
        }
        
        .diagnostic-panel {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #475569;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #475569;
        }
        
        .panel-icon {
            font-size: 2em;
            margin-right: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        .panel-title {
            color: #3b82f6;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .diagnostic-step {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #475569;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .diagnostic-step:hover {
            border-color: #3b82f6;
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.2);
        }
        
        .step-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .step-title {
            color: #e2e8f0;
            font-size: 1.2em;
            font-weight: bold;
            flex: 1;
        }
        
        .step-content {
            margin-left: 50px;
            color: #cbd5e1;
        }
        
        .measurement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .measurement-item {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 15px;
        }
        
        .measurement-label {
            color: #94a3b8;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .measurement-value {
            color: #3b82f6;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .diagnostic-tree {
            margin: 20px 0;
        }
        
        .tree-node {
            background: rgba(15, 23, 42, 0.6);
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 10px 0;
            margin-left: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .tree-condition {
            color: #fbbf24;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .tree-action {
            color: #10b981;
            margin-left: 20px;
        }
        
        .tree-warning {
            color: #ef4444;
            margin-left: 20px;
            font-style: italic;
        }
        
        .scanner-section {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #1d4ed8;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }
        
        .scanner-header {
            color: #60a5fa;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .scanner-icon {
            margin-right: 10px;
            font-size: 1.5em;
        }
        
        .code-display {
            background: #0f172a;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        
        .dtc-code {
            color: #fbbf24;
            font-weight: bold;
        }
        
        .pid-data {
            color: #10b981;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            min-width: 120px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .voltage-meter {
            background: #0f172a;
            border: 2px solid #374151;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .meter-display {
            text-align: center;
            font-size: 2em;
            color: #3b82f6;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .meter-label {
            text-align: center;
            color: #94a3b8;
            font-size: 0.9em;
        }
        
        .frequency-analyzer {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
            border: 2px solid #10b981;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .frequency-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
        }
        
        .freq-reading {
            text-align: center;
        }
        
        .freq-value {
            font-size: 1.5em;
            color: #10b981;
            font-weight: bold;
        }
        
        .freq-label {
            color: #6ee7b7;
            font-size: 0.9em;
        }
        
        .signal-strength {
            background: #0f172a;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .signal-bar {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
            transition: width 0.3s ease;
        }
        
        .advanced-tests {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #475569;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            border-color: #3b82f6;
            transform: translateY(-5px);
        }
        
        .test-title {
            color: #3b82f6;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .measurement-grid {
                grid-template-columns: 1fr;
            }
            
            .advanced-tests {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¨ Advanced TPMS Diagnostics</h1>
            <p>Expert-Level Troubleshooting Without Scanner ‚Üí Scanner Confirmation</p>
        </div>
        
        <div class="diagnostic-panel">
            <div class="panel-header">
                <div class="panel-icon">‚ö°</div>
                <div class="panel-title">Phase 1: Advanced No-Scan Diagnostics</div>
            </div>
            
            <div class="diagnostic-step">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">Electrical System Analysis</div>
                </div>
                <div class="step-content">
                    <p><strong>Battery Voltage Under Load Testing:</strong></p>
                    <div class="voltage-meter" onclick="simulateVoltageTest()">
                        <div class="meter-display" id="voltageReading">12.6V</div>
                        <div class="meter-label">Click to Test Engine Running</div>
                    </div>
                    
                    <div class="diagnostic-tree">
                        <div class="tree-node">
                            <div class="tree-condition">IF: Voltage < 12.4V (Engine Off) OR < 13.8V (Engine Running)</div>
                            <div class="tree-action">‚Üí Battery/charging system affecting TPMS receiver power</div>
                            <div class="tree-warning">‚ö†Ô∏è Low voltage causes intermittent TPMS communication failures</div>
                        </div>
                        <div class="tree-node">
                            <div class="tree-condition">IF: Voltage drops >0.3V when HVAC/lights turned on</div>
                            <div class="tree-action">‚Üí Weak battery under load - replace before TPMS diagnosis</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="diagnostic-step">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">RF Environment Analysis</div>
                </div>
                <div class="step-content">
                    <p><strong>Radio Frequency Interference Detection:</strong></p>
                    <div class="frequency-analyzer">
                        <div class="frequency-display">
                            <div class="freq-reading">
                                <div class="freq-value" id="freq315">315.00</div>
                                <div class="freq-label">315 MHz</div>
                            </div>
                            <div class="freq-reading">
                                <div class="freq-value" id="freq433">433.92</div>
                                <div class="freq-label">433 MHz</div>
                            </div>
                        </div>
                        <div class="signal-strength">
                            <div class="signal-bar" id="signalBar" style="width: 75%;"></div>
                        </div>
                        <button class="btn btn-primary" onclick="scanRFEnvironment()">Scan RF Environment</button>
                    </div>
                    
                    <div class="measurement-grid">
                        <div class="measurement-item">
                            <div class="measurement-label">Cell Phone Interference</div>
                            <div class="measurement-value" id="cellInterference">Moderate</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">WiFi 2.4GHz Overlap</div>
                            <div class="measurement-value" id="wifiOverlap">None Detected</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Garage Door Frequency</div>
                            <div class="measurement-value" id="garageFreq">315.15 MHz</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Keyless Entry Conflict</div>
                            <div class="measurement-value" id="keylessConflict">Low Risk</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="diagnostic-step">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">Sensor Physical Inspection Matrix</div>
                </div>
                <div class="step-content">
                    <div class="advanced-tests">
                        <div class="test-card" onclick="performSensorTest('visual')">
                            <div class="test-title">Visual Inspection Protocol</div>
                            <p>‚Ä¢ Valve stem corrosion analysis<br>
                            ‚Ä¢ Sensor housing crack detection<br>
                            ‚Ä¢ Antenna positioning verification<br>
                            ‚Ä¢ Mounting hardware integrity</p>
                            <button class="btn btn-primary">Start Visual Test</button>
                        </div>
                        
                        <div class="test-card" onclick="performSensorTest('mechanical')">
                            <div class="test-title">Mechanical Stress Testing</div>
                            <p>‚Ä¢ Sensor weight distribution<br>
                            ‚Ä¢ Valve stem flexibility<br>
                            ‚Ä¢ Mounting torque verification<br>
                            ‚Ä¢ Vibration damage assessment</p>
                            <button class="btn btn-warning">Start Mechanical Test</button>
                        </div>
                        
                        <div class="test-card" onclick="performSensorTest('environmental')">
                            <div class="test-title">Environmental Impact Analysis</div>
                            <p>‚Ä¢ Temperature coefficient testing<br>
                            ‚Ä¢ Humidity exposure effects<br>
                            ‚Ä¢ Salt corrosion evaluation<br>
                            ‚Ä¢ UV degradation assessment</p>
                            <button class="btn btn-success">Start Environmental Test</button>
                        </div>
                    </div>
                    
                    <div id="testResults" class="hidden"></div>
                </div>
            </div>
            
            <div class="diagnostic-step">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">Advanced Pressure Correlation Analysis</div>
                </div>
                <div class="step-content">
                    <p><strong>Multi-Point Pressure Verification:</strong></p>
                    <div class="measurement-grid">
                        <div class="measurement-item">
                            <div class="measurement-label">Cold Tire Pressure (¬∞F)</div>
                            <div class="measurement-value">
                                <input type="number" id="coldTemp" value="68" style="width: 60px; background: #0f172a; border: 1px solid #475569; color: #3b82f6; padding: 5px; border-radius: 5px;">
                            </div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Hot Tire Pressure (¬∞F)</div>
                            <div class="measurement-value">
                                <input type="number" id="hotTemp" value="95" style="width: 60px; background: #0f172a; border: 1px solid #475569; color: #3b82f6; padding: 5px; border-radius: 5px;">
                            </div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Expected Pressure Rise</div>
                            <div class="measurement-value" id="expectedRise">2.7 PSI</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Actual TPMS Reading</div>
                            <div class="measurement-value">
                                <input type="number" id="tpmsReading" value="32" style="width: 60px; background: #0f172a; border: 1px solid #475569; color: #3b82f6; padding: 5px; border-radius: 5px;">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="analyzePressureCorrelation()">Analyze Correlation</button>
                    <div id="pressureAnalysis" class="diagnostic-tree" style="margin-top: 15px;"></div>
                </div>
            </div>
        </div>
        
        <div class="scanner-section">
            <div class="scanner-header">
                <span class="scanner-icon">üì°</span>
                Phase 2: Scanner Confirmation & Advanced Diagnostics
            </div>
            
            <div class="diagnostic-step">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <div class="step-title">DTC Code Analysis Matrix</div>
                </div>
                <div class="step-content">
                    <button class="btn btn-primary" onclick="retrieveDTCs()">Retrieve All DTCs</button>
                    <div id="dtcDisplay" class="code-display">
                        <div class="dtc-code">No codes retrieved yet - Click above to scan</div>
                    </div>
                    
                    <div class="advanced-tests">
                        <div class="test-card">
                            <div class="test-title">Current DTCs</div>
                            <div id="currentDTCs">Ready to scan...</div>
                        </div>
                        <div class="test-card">
                            <div class="test-title">Pending DTCs</div>
                            <div id="pendingDTCs">Ready to scan...</div>
                        </div>
                        <div class="test-card">
                            <div class="test-title">History DTCs</div>
                            <div id="historyDTCs">Ready to scan...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="diagnostic-step">
                <div class="step-header">
                    <div class="step-number">6</div>
                    <div class="step-title">Live Data Stream Analysis</div>
                </div>
                <div class="step-content">
                    <button class="btn btn-success" onclick="startLiveData()">Start Live Data Stream</button>
                    <div class="measurement-grid" id="liveDataGrid">
                        <div class="measurement-item">
                            <div class="measurement-label">RF LF: Sensor Position</div>
                            <div class="measurement-value" id="rflfPos">Monitoring...</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">RF RF: Sensor Position</div>
                            <div class="measurement-value" id="rfrfPos">Monitoring...</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">LR LF: Sensor Position</div>
                            <div class="measurement-value" id="lrlfPos">Monitoring...</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">LR RF: Sensor Position</div>
                            <div class="measurement-value" id="lrrfPos">Monitoring...</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Signal Strength (dBm)</div>
                            <div class="measurement-value" id="signalStrength">-45 dBm</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Battery Voltage (Sensor)</div>
                            <div class="measurement-value" id="sensorBattery">3.2V</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Transmission Rate</div>
                            <div class="measurement-value" id="transmissionRate">Every 60s</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Module Temperature</div>
                            <div class="measurement-value" id="moduleTemp">72¬∞F</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="diagnostic-step">
                <div class="step-header">
                    <div class="step-number">7</div>
                    <div class="step-title">Sensor ID Programming & Cloning</div>
                </div>
                <div class="step-content">
                    <p><strong>Advanced Sensor Programming Protocol:</strong></p>
                    <div class="advanced-tests">
                        <div class="test-card">
                            <div class="test-title">Read Original Sensor IDs</div>
                            <button class="btn btn-primary" onclick="readSensorIDs()">Read IDs</button>
                            <div id="originalIDs" class="code-display">
                                <div class="pid-data">Click to read sensor IDs...</div>
                            </div>
                        </div>
                        
                        <div class="test-card">
                            <div class="test-title">Program Blank Sensors</div>
                            <button class="btn btn-warning" onclick="programBlankSensors()">Program New IDs</button>
                            <div id="programmingStatus" class="code-display">
                                <div class="pid-data">Ready to program...</div>
                            </div>
                        </div>
                        
                        <div class="test-card">
                            <div class="test-title">Clone Existing Sensors</div>
                            <button class="btn btn-success" onclick="cloneSensors()">Start Cloning</button>
                            <div id="cloningStatus" class="code-display">
                                <div class="pid-data">Ready to clone...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="diagnostic-step">
                <div class="step-header">
                    <div class="step-number">8</div>
                    <div class="step-title">Advanced Relearn Verification</div>
                </div>
                <div class="step-content">
                    <button class="btn btn-primary" onclick="performAdvancedRelearn()">Start Advanced Relearn</button>
                    <div id="relearnProgress" class="diagnostic-tree"></div>
                    
                    <div class="measurement-grid" style="margin-top: 20px;">
                        <div class="measurement-item">
                            <div class="measurement-label">Relearn Success Rate</div>
                            <div class="measurement-value" id="successRate">0%</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Sensor Response Time</div>
                            <div class="measurement-value" id="responseTime">0ms</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Signal Quality</div>
                            <div class="measurement-value" id="signalQuality">Excellent</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Position Accuracy</div>
                            <div class="measurement-value" id="positionAccuracy">100%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let diagnosticData = {
            voltage: 12.6,
            rfEnvironment: {},
            sensorTests: {},
            pressureData: {},
            dtcCodes: [],
            liveData: {},
            sensorIDs: [],
            relearnStatus: {}
        };
        
        let liveDataInterval;
        
        function simulateVoltageTest() {
            const voltageElement = document.getElementById('voltageReading');
            const readings = [13.8, 13.9, 13.7, 14.1, 13.8];
            let index = 0;
            
            const interval = setInterval(() => {
                voltageElement.textContent = readings[index] + 'V';
                diagnosticData.voltage = readings[index];
                index++;
                
                if (index >= readings.length) {
                    clearInterval(interval);
                    analyzeVoltage(readings[readings.length - 1]);
                }
            }, 500);
        }
        
        function analyzeVoltage(finalVoltage) {
            const step = document.querySelector('.diagnostic-step');
            let analysis = '';
            
            if (finalVoltage < 13.8) {
                analysis = `
                    <div class="tree-node" style="border-left-color: #ef4444;">
                        <div class="tree-condition">‚ö†Ô∏è LOW VOLTAGE DETECTED: ${finalVoltage}V</div>
                        <div class="tree-warning">Charging system issue - affects TPMS receiver power</div>
                        <div class="tree-action">‚Üí Test alternator output and battery condition before continuing</div>
                    </div>
                `;
            } else {
                analysis = `
                    <div class="tree-node" style="border-left-color: #10b981;">
                        <div class="tree-condition">‚úÖ VOLTAGE NORMAL: ${finalVoltage}V</div>
                        <div class="tree-action">‚Üí Electrical system supporting TPMS operation</div>
                    </div>
                `;
            }
            
            step.innerHTML += analysis;
        }
        
        function scanRFEnvironment() {
            const cellInterference = document.getElementById('cellInterference');
            const wifiOverlap = document.getElementById('wifiOverlap');
            const garageFreq = document.getElementById('garageFreq');
            const keylessConflict = document.getElementById('keylessConflict');
            const signalBar = document.getElementById('signalBar');
            
            // Simulate RF scan
            setTimeout(() => {
                cellInterference.textContent = 'High - 3 devices detected';
                cellInterference.style.color = '#ef4444';
                wifiOverlap.textContent = '2.4GHz conflict detected';
                wifiOverlap.style.color = '#f59e0b';
                garageFreq.textContent = '315.125 MHz - CONFLICT!';
                garageFreq.style.color = '#ef4444';
                keylessConflict.textContent = 'High Risk - Same frequency';
                keylessConflict.style.color = '#ef4444';
                signalBar.style.width = '35%';
                signalBar.style.background = 'linear-gradient(90deg, #ef4444, #f59e0b)';
                
                // Add RF analysis
                const rfAnalysis = `
                    <div class="diagnostic-tree" style="margin-top: 20px;">
                        <div class="tree-node" style="border-left-color: #ef4444;">
                            <div class="tree-condition">‚ö†Ô∏è CRITICAL RF INTERFERENCE DETECTED</div>
                            <div class="tree-warning">Multiple 315MHz sources causing signal degradation</div>
                            <div class="tree-action">‚Üí Move vehicle away from garage/building before testing</div>
                            <div class="tree-action">‚Üí Turn off cell phones and WiFi devices</div>
                        </div>
                    </div>
                `;
                document.querySelector('.frequency-analyzer').innerHTML += rfAnalysis;
            }, 2000);
        }
        
        function performSensorTest(testType) {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.classList.remove('hidden');
            resultsDiv.classList.add('fade-in');
            
            let testResults = '';
            
            switch(testType) {
                case 'visual':
                    testResults = `
                        <div class="diagnostic-tree">
                            <div class="tree-node">
                                <div class="tree-condition">Visual Inspection Results:</div>
                                <div class="tree-action">‚úÖ RF Sensor: No visible corrosion, antenna intact</div>
                                <div class="tree-warning">‚ö†Ô∏è LF Sensor: Minor valve stem corrosion detected</div>
                                <div class="tree-action">‚úÖ RR Sensor: Good condition, proper mounting</div>
                                <div class="tree-warning">‚ö†Ô∏è LR Sensor: Crack in housing near antenna</div>
                            </div>
                            <div class="tree-node" style="border-left-color: #ef4444;">
                                <div class="tree-condition">CRITICAL FINDING:</div>
                                <div class="tree-warning">LR sensor housing crack will cause intermittent signal loss</div>
                                <div class="tree-action">‚Üí Replace LR sensor before proceeding</div>
                            </div>
                        </div>
                    `;
                    break;
                case 'mechanical':
                    testResults = `
                        <div class="diagnostic-tree">
                            <div class="tree-node">
                                <div class="tree-condition">Mechanical Stress Analysis:</div>
                                <div class="tree-action">‚úÖ Valve stem torque: 35 in-lbs (within spec)</div>
                                <div class="tree-action">‚úÖ Sensor weight distribution: Balanced</div>
                                <div class="tree-warning">‚ö†Ô∏è Excessive vibration wear on LF sensor mount</div>
                                <div class="tree-action">‚Üí Monitor for intermittent connection issues</div>
                            </div>
                        </div>
                    `;
                    break;
                case 'environmental':
                    testResults = `
                        <div class="diagnostic-tree">
                            <div class="tree-node">
                                <div class="tree-condition">Environmental Impact Assessment:</div>
                                <div class="tree-action">Temperature coefficient: -0.5 PSI per 10¬∞F (normal)</div>
                                <div class="tree-warning">‚ö†Ô∏è Salt corrosion on valve threads affecting seal</div>
                                <div class="tree-action">UV exposure: Minimal degradation on sensor housing</div>
                                <div class="tree-action">‚Üí Clean and apply anti-seize to valve threads</div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            resultsDiv.innerHTML = testResults;
        }
        
        function analyzePressureCorrelation() {
            const coldTemp = parseFloat(document.getElementById('coldTemp').value);
            const hotTemp = parseFloat(document.getElementById('hotTemp').value);
            const tpmsReading = parseFloat(document.getElementById('tpmsReading').value);
            
            const tempDiff = hotTemp - coldTemp;
            const expectedRise = (tempDiff / 10) * 1; // Approximate 1 PSI per 10¬∞F
            document.getElementById('expectedRise').textContent = expectedRise.toFixed(1) + ' PSI';
            
            const analysisDiv = document.getElementById('pressureAnalysis');
            let analysis = '';
            
            if (Math.abs(tpmsReading - (32 + expectedRise)) > 2) {
                analysis = `
                    <div class="tree-node" style="border-left-color: #ef4444;">
                        <div class="tree-condition">‚ö†Ô∏è PRESSURE CORRELATION ERROR</div>
                        <div class="tree-warning">TPMS reading deviates >2 PSI from expected thermal expansion</div>
                        <div class="tree-action">‚Üí Sensor calibration drift detected</div>
                        <div class="tree-action">‚Üí Perform sensor accuracy verification with precision gauge</div>
                    </div>
                `;
            } else {
                analysis = `
                    <div class="tree-node" style="border-left-color: #10b981;">
                        <div class="tree-condition">‚úÖ PRESSURE CORRELATION NORMAL</div>
                        <div class="tree-action">TPMS readings correlate with thermal expansion model</div>
                        <div class="tree-action">‚Üí Sensor accuracy within acceptable range</div>
                    </div>
                `;
            }
            
            analysisDiv.innerHTML = analysis;
        }
        
        function retrieveDTCs() {
            const dtcDisplay = document.getElementById('dtcDisplay');
            const currentDTCs = document.getElementById('currentDTCs');
            const pendingDTCs = document.getElementById('pendingDTCs');
            const historyDTCs = document.getElementById('historyDTCs');
            
            // Simulate DTC retrieval
            setTimeout(() => {
                const codes = [
                    'C1A11: TPMS Sensor 1 Signal Missing',
                    'C1A15: TPMS Sensor 3 Low Battery',
                    'C1A01: TPMS System Communication Fault'
                ];
                
                dtcDisplay.innerHTML = `
                    <div class="dtc-code">Current DTCs Found:</div>
                    ${codes.map(code => `<div class="pid-data">${code}</div>`).join('')}
                `;
                
                currentDTCs.innerHTML = `
                    <div style="color: #ef4444;">C1A11 - Active</div>
                    <div style="color: #ef4444;">C1A15 - Active</div>
                `;
                
                pendingDTCs.innerHTML = `
                    <div style="color: #f59e0b;">C1A01 - Pending</div>
                    <div style="color: #f59e0b;">C1A20 - Pending (Relearn Required)</div>
                `;
                
                historyDTCs.innerHTML = `
                    <div style="color: #94a3b8;">C1A12 - Sensor 2 Signal (Cleared)</div>
                    <div style="color: #94a3b8;">C1A00 - System Malfunction (Cleared)</div>
                `;
                
                diagnosticData.dtcCodes = codes;
            }, 1500);
        }
        
        function startLiveData() {
            const positions = ['Front Left', 'Front Right', 'Rear Left', 'Rear Right'];
            let dataCounter = 0;
            
            liveDataInterval = setInterval(() => {
                // Simulate live sensor data
                document.getElementById('rflfPos').textContent = Math.random() > 0.1 ? 'Active' : 'No Signal';
                document.getElementById('rfrfPos').textContent = 'Active';
                document.getElementById('lrlfPos').textContent = 'Weak Signal';
                document.getElementById('lrrfPos').textContent = Math.random() > 0.3 ? 'Active' : 'Intermittent';
                
                document.getElementById('signalStrength').textContent = (-45 + Math.random() * 10).toFixed(1) + ' dBm';
                document.getElementById('sensorBattery').textContent = (3.2 - Math.random() * 0.5).toFixed(1) + 'V';
                document.getElementById('transmissionRate').textContent = 'Every ' + (60 + Math.random() * 30).toFixed(0) + 's';
                document.getElementById('moduleTemp').textContent = (72 + Math.random() * 10).toFixed(0) + '¬∞F';
                
                dataCounter++;
                if (dataCounter > 10) {
                    clearInterval(liveDataInterval);
                    analyzeLiveData();
                }
            }, 1000);
        }
        
        function analyzeLiveData() {
            const liveDataGrid = document.getElementById('liveDataGrid');
            const analysis = `
                <div class="diagnostic-tree" style="grid-column: 1 / -1; margin-top: 20px;">
                    <div class="tree-node" style="border-left-color: #ef4444;">
                        <div class="tree-condition">‚ö†Ô∏è LIVE DATA ANALYSIS COMPLETE</div>
                        <div class="tree-warning">RF sensor intermittent - signal strength varying</div>
                        <div class="tree-warning">LR sensor weak signal - battery voltage low (2.7V)</div>
                        <div class="tree-action">‚Üí Replace LR sensor battery/sensor unit</div>
                        <div class="tree-action">‚Üí Investigate RF sensor connection</div>
                    </div>
                </div>
            `;
            liveDataGrid.innerHTML += analysis;
        }
        
        function readSensorIDs() {
            const originalIDs = document.getElementById('originalIDs');
            
            setTimeout(() => {
                const sensorIDs = [
                    'FL: 0x12345678 (315 MHz)',
                    'FR: 0x87654321 (315 MHz)', 
                    'RL: 0xABCDEF12 (315 MHz)',
                    'RR: 0x34567890 (315 MHz)'
                ];
                
                originalIDs.innerHTML = `
                    <div class="pid-data">Original Sensor IDs:</div>
                    ${sensorIDs.map(id => `<div class="dtc-code">${id}</div>`).join('')}
                `;
                
                diagnosticData.sensorIDs = sensorIDs;
            }, 2000);
        }
        
        function programBlankSensors() {
            const programmingStatus = document.getElementById('programmingStatus');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += 25;
                programmingStatus.innerHTML = `
                    <div class="pid-data">Programming Progress: ${progress}%</div>
                    <div class="dtc-code">Writing sensor ID: 0x${Math.random().toString(16).substr(2, 8).toUpperCase()}</div>
                `;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    programmingStatus.innerHTML += `
                        <div style="color: #10b981; margin-top: 10px;">‚úÖ Programming Complete - 4 sensors programmed</div>
                        <div style="color: #10b981;">‚úÖ IDs written to ECU memory</div>
                    `;
                }
            }, 1000);
        }
        
        function cloneSensors() {
            const cloningStatus = document.getElementById('cloningStatus');
            let step = 0;
            const steps = [
                'Reading original sensor signatures...',
                'Extracting encryption keys...',
                'Programming clone sensors...',
                'Verifying sensor responses...',
                'Updating ECU database...'
            ];
            
            const interval = setInterval(() => {
                if (step < steps.length) {
                    cloningStatus.innerHTML = `
                        <div class="pid-data">${steps[step]}</div>
                        <div class="dtc-code">Step ${step + 1} of ${steps.length}</div>
                    `;
                    step++;
                } else {
                    clearInterval(interval);
                    cloningStatus.innerHTML += `
                        <div style="color: #10b981; margin-top: 10px;">‚úÖ Cloning Complete</div>
                        <div style="color: #10b981;">‚úÖ All sensors responding with original IDs</div>
                    `;
                }
            }, 1500);
        }
        
        function performAdvancedRelearn() {
            const relearnProgress = document.getElementById('relearnProgress');
            const successRate = document.getElementById('successRate');
            const responseTime = document.getElementById('responseTime');
            const signalQuality = document.getElementById('signalQuality');
            const positionAccuracy = document.getElementById('positionAccuracy');
            
            let currentStep = 0;
            const steps = [
                'Initializing TPMS receiver module...',
                'Activating sensor learn mode...',
                'Triggering FL sensor (315 MHz)...',
                'Triggering FR sensor (315 MHz)...',
                'Triggering RL sensor (315 MHz)...',
                'Triggering RR sensor (315 MHz)...',
                'Verifying sensor positions...',
                'Updating ECU sensor database...',
                'Performing final validation...'
            ];
            
            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    const progress = ((currentStep + 1) / steps.length * 100).toFixed(0);
                    successRate.textContent = progress + '%';
                    responseTime.textContent = (100 + Math.random() * 50).toFixed(0) + 'ms';
                    
                    relearnProgress.innerHTML = `
                        <div class="tree-node" style="border-left-color: #3b82f6;">
                            <div class="tree-condition">Step ${currentStep + 1}: ${steps[currentStep]}</div>
                            <div class="tree-action">Progress: ${progress}%</div>
                        </div>
                    `;
                    
                    if (currentStep === 2) signalQuality.textContent = 'Good';
                    if (currentStep === 4) signalQuality.textContent = 'Excellent';
                    if (currentStep === 6) positionAccuracy.textContent = '100%';
                    
                    currentStep++;
                } else {
                    clearInterval(interval);
                    relearnProgress.innerHTML += `
                        <div class="tree-node" style="border-left-color: #10b981;">
                            <div class="tree-condition">‚úÖ ADVANCED RELEARN COMPLETE</div>
                            <div class="tree-action">All sensors learned and verified</div>
                            <div class="tree-action">Position accuracy: 100%</div>
                            <div class="tree-action">System ready for operation</div>
                        </div>
                    `;
                }
            }, 2000);
        }
        
        // Initialize diagnostic system
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Advanced TPMS Diagnostic System Initialized');
            
            // Add some dynamic effects
            setInterval(() => {
                const freq315 = document.getElementById('freq315');
                const freq433 = document.getElementById('freq433');
                
                if (freq315) {
                    freq315.textContent = (315.00 + (Math.random() - 0.5) * 0.1).toFixed(2);
                }
                if (freq433) {
                    freq433.textContent = (433.92 + (Math.random() - 0.5) * 0.1).toFixed(2);
                }
            }, 3000);
        });
    </script>
</body>
</html>
