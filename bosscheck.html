<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BossCheck â€” Manager Accountability Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  FIREBASE SETUP â€” 5 MINUTES                            â•‘
     â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
     â•‘  1. Go to https://console.firebase.google.com           â•‘
     â•‘  2. "Add project" â†’ name it bosscheck â†’ Continue        â•‘
     â•‘  3. Click </> to register a web app â†’ get config        â•‘
     â•‘  4. Paste your config values in the script below        â•‘
     â•‘  5. Build â†’ Firestore Database â†’ Create database        â•‘
     â•‘     â†’ Start in TEST MODE â†’ Enable                       â•‘
     â•‘  6. Open this file in any browser â€” it just works!      â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<script type="module">
import { initializeApp }   from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import {
  getFirestore, collection, doc, addDoc, getDoc, getDocs,
  updateDoc, query, onSnapshot, serverTimestamp, where, orderBy
} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

// â”€â”€â”€ ğŸ”¥ PASTE YOUR CONFIG HERE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const firebaseConfig = {
  apiKey:            "AIzaSyAGtDXKNtplaXVFmMjpXcAGL2WdN0VCvrA",
  authDomain:        "bosscheck-3ab3c.firebaseapp.com",
  projectId:         "bosscheck-3ab3c",
  storageBucket:     "bosscheck-3ab3c.firebasestorage.app",
  messagingSenderId: "489504073968",
  appId:             "1:489504073968:web:270ec0fe0c1c14412ffa35"
};
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const fbApp = initializeApp(firebaseConfig);
const db    = getFirestore(fbApp);

// â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const el     = id => document.getElementById(id);
const calcScore = (c, k) => { const t = c+k; return t===0 ? 50 : Math.round(k/t*100); };
const scoreClass = s => s >= 65 ? 'good' : s >= 35 ? 'mid' : 'bad';
const trunc = (s, n) => s.length > n ? s.substring(0,n)+'â€¦' : s;
const fmtDate = ts => ts?.toDate ? ts.toDate().toISOString().split('T')[0] : (ts||'');

// â”€â”€ App state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let allManagers       = [];
let currentManagerId  = null;
let currentReviewType = 'complaint';
let currentAddType    = 'complaint';
let searchDebounce    = null;
let unsubDetail       = null;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SEED  (only runs when Firestore collection is empty)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function maybeSeed() {
  const snap = await getDocs(collection(db, 'managers'));
  if (!snap.empty) return;

  const managers = [
    { name:"Dave Kellerman",  role:"Store Manager",     company:"QuickMart (Dallas, TX)",    industry:"Retail",     complaints:3, commends:0 },
    { name:"Sandra Ortiz",    role:"Shift Supervisor",  company:"Burger Palace (Miami, FL)", industry:"Restaurant", complaints:0, commends:2 },
    { name:"Tom Weiss",       role:"Regional Director", company:"LogiCo Warehousing",        industry:"Logistics",  complaints:2, commends:1 },
    { name:"Angela Marsh",    role:"Department Head",   company:"CareFirst Hospital",        industry:"Healthcare", complaints:0, commends:3 },
    { name:"Brett Carlson",   role:"Team Lead",         company:"NexaTech Solutions",        industry:"Tech",       complaints:2, commends:0 },
  ];
  const reviewMap = {
    "Dave Kellerman": [
      {type:"complaint",text:"Schedules with no notice and denies time-off requests without explanation. Multiple employees have quit.",category:"Scheduling issues",reviewer_role:"Cashier"},
      {type:"complaint",text:"Consistently favors certain employees based on personal relationships, not performance.",category:"Favoritism",reviewer_role:"Stock Associate"},
      {type:"complaint",text:"Talks down to part-time staff in front of customers. Very demeaning behavior.",category:"Workplace conduct",reviewer_role:"Sales Floor"},
    ],
    "Sandra Ortiz": [
      {type:"commend",text:"Sandra always has the team's back. Covers shifts when short-staffed and never makes you feel bad for calling in sick.",category:"Leadership",reviewer_role:"Line Cook"},
      {type:"commend",text:"Best supervisor I've ever had. Clear communicator, fair scheduling, actually listens.",category:"Communication",reviewer_role:"Server"},
    ],
    "Tom Weiss": [
      {type:"complaint",text:"Pressures staff to skip safety checks to meet quotas. Has been reported to OSHA.",category:"Workplace conduct",reviewer_role:"Warehouse Associate"},
      {type:"complaint",text:"Retaliated against a coworker who filed an HR complaint â€” reassigned to worse shifts.",category:"Discrimination",reviewer_role:"Forklift Operator"},
      {type:"commend", text:"He did fight for our raises last year. Day-to-day management is still a problem though.",category:"Leadership",reviewer_role:"Team Lead"},
    ],
    "Angela Marsh": [
      {type:"commend",text:"Incredibly supportive during high-stress situations. Advocates for nurses with administration.",category:"Leadership",reviewer_role:"RN"},
      {type:"commend",text:"Transparent about decisions and explains her reasoning. Rare in healthcare management.",category:"Communication",reviewer_role:"CNA"},
      {type:"commend",text:"Pushes back on unsafe staffing ratios. Genuinely looks out for patient safety.",category:"Workplace conduct",reviewer_role:"Charge Nurse"},
    ],
    "Brett Carlson": [
      {type:"complaint",text:"Takes credit for the team's work in exec meetings. Sprint contributions never acknowledged.",category:"Workplace conduct",reviewer_role:"Software Engineer"},
      {type:"complaint",text:"Micromanages every ticket and PR. Zero autonomy. Several senior devs have left.",category:"Leadership",reviewer_role:"Senior Dev"},
    ],
  };

  for (const m of managers) {
    const mRef = await addDoc(collection(db, 'managers'), {
      ...m,
      score: calcScore(m.complaints, m.commends),
      total_reviews: m.complaints + m.commends,
      latest_review: (reviewMap[m.name]?.slice(-1)[0]?.text || ''),
      created_at: serverTimestamp(),
    });
    for (const r of (reviewMap[m.name] || [])) {
      await addDoc(collection(db, 'reviews'), { ...r, manager_id: mRef.id, created_at: serverTimestamp() });
    }
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LIVE MANAGERS LIST
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function subscribeManagers() {
  onSnapshot(collection(db, 'managers'), snap => {
    allManagers = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    updateStats();
    applyFilter();
    setDbStatus(true);
  }, err => {
    console.error(err);
    setDbStatus(false);
    el('managers-grid').innerHTML = `<div class="empty-state"><span class="icon">ğŸ”¥</span><strong style="color:var(--accent)">Firebase not connected.</strong><br><br>Paste your Firebase config at the top of this file,<br>then enable Firestore in your Firebase console.</div>`;
  });
}

function updateStats() {
  const total = allManagers.reduce((s, m) => s + (m.total_reviews||0), 0);
  const cos   = new Set(allManagers.map(m => m.company)).size;
  el('total-managers').textContent  = allManagers.length;
  el('total-reviews').textContent   = total;
  el('total-companies').textContent = cos;
}

function applyFilter() {
  const q  = el('search-input').value.trim().toLowerCase();
  const ind = el('filter-industry').value;
  let list = allManagers.filter(m => {
    const mq = !q || [m.name, m.company, m.industry].some(s => s.toLowerCase().includes(q));
    const mi = !ind || m.industry === ind;
    return mq && mi;
  });
  list.sort((a, b) => (b.complaints||0) - (a.complaints||0));
  renderGrid(list);
}

function renderGrid(list) {
  el('result-count').textContent = `${list.length} manager${list.length!==1?'s':''} found`;
  if (!list.length) {
    el('managers-grid').innerHTML = `<div class="empty-state"><span class="icon">ğŸ”</span>No managers match your search.<br>Be the first to add one.</div>`;
    return;
  }
  el('managers-grid').innerHTML = list.map(m => {
    const cls = scoreClass(m.score ?? 50);
    return `<div class="manager-card ${cls}" onclick="window._openDetail('${m.id}')">
      <div class="card-top">
        <div><div class="manager-name">${m.name}</div><div class="manager-role">${m.role}</div></div>
        <div class="score-badge ${cls}">${m.score ?? 50}</div>
      </div>
      <div class="company-tag">${m.company} Â· ${m.industry}</div>
      <div class="card-stats">
        <div class="card-stat complaints"><strong>${m.complaints||0}</strong><span>Complaints</span></div>
        <div class="card-stat commend"><strong>${m.commends||0}</strong><span>Commendations</span></div>
        <div class="card-stat"><strong>${m.total_reviews||0}</strong><span>Total Reviews</span></div>
      </div>
      ${m.latest_review ? `<div class="latest-review">"${trunc(m.latest_review,100)}"</div>` : ''}
    </div>`;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DETAIL MODAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window._openDetail = async function(id) {
  currentManagerId = id;
  openModal('detail-modal');
  if (unsubDetail) { unsubDetail(); unsubDetail = null; }

  el('modal-name').textContent  = 'Loading...';
  el('modal-reviews').innerHTML = '<div class="loading" style="grid-column:unset;border:none;padding:30px">Fetching from Firebaseâ€¦</div>';

  // Live manager doc
  unsubDetail = onSnapshot(doc(db, 'managers', id), async snap => {
    const m   = { id: snap.id, ...snap.data() };
    const cls = scoreClass(m.score ?? 50);
    el('modal-name').textContent    = m.name;
    el('modal-role').textContent    = m.role;
    el('modal-company').textContent = `${m.company} Â· ${m.industry}`;
    el('modal-big-score').textContent  = m.score ?? 50;
    el('modal-big-score').className    = 'big-score ' + cls;
    el('modal-total-reviews').textContent = m.total_reviews || 0;
    el('bar-complaints-val').textContent  = m.complaints || 0;
    el('bar-commend-val').textContent     = m.commends   || 0;
    const total = (m.total_reviews || 0) || 1;
    setTimeout(() => {
      el('bar-complaints').style.width = `${(m.complaints||0)/total*100}%`;
      el('bar-commend').style.width    = `${(m.commends||0)/total*100}%`;
    }, 80);

    // Reviews
    const rSnap   = await getDocs(query(collection(db, 'reviews'), where('manager_id','==',id)));
    const reviews = rSnap.docs.map(d => ({id:d.id,...d.data()}))
                               .sort((a,b) => (b.created_at?.seconds||0) - (a.created_at?.seconds||0));
    el('modal-reviews').innerHTML = reviews.length
      ? reviews.map(r => `
          <div class="review-item">
            <span class="review-type ${r.type}">${r.type==='complaint'?'âš  COMPLAINT':'âœ“ COMMENDATION'}</span>
            <div class="review-text">${r.text}</div>
            <div class="review-meta">${[r.category, r.reviewer_role, fmtDate(r.created_at)].filter(Boolean).join(' Â· ')}</div>
          </div>`).join('')
      : `<div class="empty-state" style="grid-column:unset"><span class="icon">ğŸ“</span>No reviews yet. Be the first.</div>`;
  });

  el('review-text').value = '';
  el('review-role').value = '';
  setType('complaint');
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SUBMIT REVIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window._submitReview = async function() {
  const text = el('review-text').value.trim();
  if (!text) { showToast('Please write a review.', true); return; }
  const btn = el('review-submit-btn');
  btn.disabled = true; btn.textContent = 'SAVING...';
  try {
    await addDoc(collection(db, 'reviews'), {
      manager_id: currentManagerId, type: currentReviewType, text,
      category: el('review-category').value,
      reviewer_role: el('review-role').value || 'Anonymous Employee',
      created_at: serverTimestamp(),
    });
    const mRef  = doc(db, 'managers', currentManagerId);
    const mSnap = await getDoc(mRef);
    const m     = mSnap.data();
    const nc    = (m.complaints||0) + (currentReviewType==='complaint' ? 1 : 0);
    const nk    = (m.commends||0)   + (currentReviewType==='commend'   ? 1 : 0);
    await updateDoc(mRef, { complaints: nc, commends: nk, total_reviews: (m.total_reviews||0)+1, score: calcScore(nc,nk), latest_review: text });
    showToast('Review saved to Firebase ğŸ”¥');
  } catch(e) { console.error(e); showToast('Failed to submit.', true); }
  finally { btn.disabled = false; btn.textContent = 'SUBMIT REVIEW'; }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADD MANAGER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window._openAddManager = function() {
  ['add-name','add-role','add-company','add-review'].forEach(id => el(id).value='');
  setAddType('complaint');
  openModal('add-modal');
};

window._addManager = async function() {
  const name=el('add-name').value.trim(), role=el('add-role').value.trim(),
        company=el('add-company').value.trim(), review=el('add-review').value.trim(),
        industry=el('add-industry').value;
  if (!name||!role||!company||!review) { showToast('Fill in all required fields.', true); return; }
  const btn = el('add-submit-btn');
  btn.disabled=true; btn.textContent='SAVING...';
  try {
    const c = currentAddType==='complaint' ? 1 : 0;
    const k = currentAddType==='commend'   ? 1 : 0;
    const mRef = await addDoc(collection(db, 'managers'), {
      name, role, company, industry, complaints:c, commends:k,
      total_reviews:1, score:calcScore(c,k), latest_review:review, created_at:serverTimestamp(),
    });
    await addDoc(collection(db,'reviews'), {
      manager_id:mRef.id, type:currentAddType, text:review,
      category:'Workplace conduct', reviewer_role:'Anonymous Employee', created_at:serverTimestamp(),
    });
    closeModal('add-modal');
    showToast(`${name} added to Firebase ğŸ”¥`);
  } catch(e) { console.error(e); showToast('Failed to add manager.', true); }
  finally { btn.disabled=false; btn.textContent='ADD TO DATABASE'; }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RANKINGS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window._loadRankings = async function() {
  const list = el('rankings-list');
  list.innerHTML = '<div class="loading" style="border:none">Loading from Firebaseâ€¦</div>';
  try {
    const managers = [...allManagers].sort((a,b) => (b.score??50)-(a.score??50));
    list.innerHTML = managers.map((m,i) => {
      const cls = scoreClass(m.score??50);
      return `<div class="rank-row" onclick="showView('browse');setTimeout(()=>window._openDetail('${m.id}'),200)">
        <div class="rank-num">${i+1}</div>
        <div style="flex:1"><div style="font-weight:700;font-size:16px">${m.name}</div>
          <div style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px;margin-top:3px">${m.role} Â· ${m.company}</div></div>
        <div style="font-family:'IBM Plex Mono',monospace;font-size:11px;text-align:right">
          <div style="color:var(--bad)">âš  ${m.complaints||0} complaints</div>
          <div style="color:var(--good);margin-top:4px">âœ“ ${m.commends||0} commendations</div>
        </div>
        <div class="score-badge ${cls}" style="font-size:44px;min-width:70px;text-align:right">${m.score??50}</div>
      </div>`;
    }).join('');
  } catch(e) {
    list.innerHTML = '<div class="empty-state" style="grid-column:unset"><span class="icon">âš </span>Could not load rankings.</div>';
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UI HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setType(t) {
  currentReviewType = t;
  el('type-complaint').classList.toggle('active', t==='complaint');
  el('type-commend').classList.toggle('active', t==='commend');
}
function setAddType(t) {
  currentAddType = t;
  el('add-type-complaint').classList.toggle('active', t==='complaint');
  el('add-type-commend').classList.toggle('active', t==='commend');
}
function setDbStatus(ok) {
  el('db-dot').className = 'db-dot' + (ok?'':' error');
  el('db-status').textContent = ok ? 'Firebase âœ“' : 'Offline';
}
function openModal(id)  { el(id).classList.add('open'); }
function closeModal(id) {
  el(id).classList.remove('open');
  if (id==='detail-modal' && unsubDetail) { unsubDetail(); unsubDetail=null; }
}
let toastTimer;
function showToast(msg, err=false) {
  const t=el('toast'); t.textContent=msg;
  t.className='toast'+(err?' error':'')+' show';
  clearTimeout(toastTimer); toastTimer=setTimeout(()=>t.classList.remove('show'),3500);
}
function debounceSearch() { clearTimeout(searchDebounce); searchDebounce=setTimeout(applyFilter,250); }
function showView(v) {
  el('browse-view').style.display   = v==='browse'   ? 'block' : 'none';
  el('rankings-view').style.display = v==='rankings' ? 'block' : 'none';
  document.querySelectorAll('nav button:not(.primary)').forEach((b,i) =>
    b.classList.toggle('active', (i===0&&v==='browse')||(i===1&&v==='rankings'))
  );
  if (v==='rankings') window._loadRankings();
}

// Expose to HTML
window.setType=setType; window.setAddType=setAddType; window.showView=showView;
window.closeModal=closeModal; window.debounceSearch=debounceSearch; window.applyFilter=applyFilter;

document.querySelectorAll('.modal-overlay').forEach(overlay =>
  overlay.addEventListener('click', e => { if(e.target===overlay) closeModal(overlay.id); })
);

// â”€â”€ Bootstrap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async () => {
  try {
    await maybeSeed();
    subscribeManagers();
  } catch(e) {
    console.error('Init error:', e);
    setDbStatus(false);
    el('managers-grid').innerHTML = `<div class="empty-state"><span class="icon">ğŸ”¥</span><strong style="color:var(--accent)">Firebase not configured.</strong><br><br>Paste your firebaseConfig values at the top of this file.</div>`;
  }
})();
</script>

<style>
  :root{--bg:#0e0e0e;--surface:#161616;--surface2:#1e1e1e;--border:#2a2a2a;--accent:#e8ff47;--text:#f0f0f0;--muted:#888;--good:#47ff8a;--bad:#ff4747}
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:var(--bg);color:var(--text);font-family:'IBM Plex Sans',sans-serif;min-height:100vh;overflow-x:hidden}
  body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;opacity:0.3}
  header{border-bottom:1px solid var(--border);padding:0 40px;display:flex;align-items:center;justify-content:space-between;height:64px;position:sticky;top:0;background:rgba(14,14,14,.95);backdrop-filter:blur(10px);z-index:100}
  .logo{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;color:var(--accent);display:flex;align-items:center;gap:10px}
  .logo span{color:var(--text)}
  .logo-badge{background:var(--accent);color:#000;font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:600;padding:2px 6px;letter-spacing:1px;transform:translateY(-2px)}
  nav{display:flex;gap:6px;align-items:center}
  nav button{background:transparent;border:1px solid var(--border);color:var(--muted);font-family:'IBM Plex Mono',monospace;font-size:11px;letter-spacing:1px;padding:8px 16px;cursor:pointer;transition:all .15s;text-transform:uppercase}
  nav button:hover,nav button.active{border-color:var(--accent);color:var(--accent)}
  nav button.primary{background:var(--accent);border-color:var(--accent);color:#000;font-weight:600}
  nav button.primary:hover{background:#d4eb00;color:#000}
  .db-indicator{display:flex;align-items:center;gap:6px;font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px}
  .db-dot{width:6px;height:6px;border-radius:50%;background:var(--good);animation:pulse 2s ease-in-out infinite}
  .db-dot.error{background:var(--bad);animation:none}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
  .ticker{background:var(--accent);color:#000;font-family:'IBM Plex Mono',monospace;font-size:11px;font-weight:600;letter-spacing:2px;padding:6px 0;overflow:hidden;white-space:nowrap}
  .ticker-inner{display:inline-block;animation:ticker 30s linear infinite}
  @keyframes ticker{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
  main{max-width:1200px;margin:0 auto;padding:40px}
  .hero{padding:60px 0 40px;border-bottom:1px solid var(--border);margin-bottom:40px;display:grid;grid-template-columns:1fr 300px;gap:40px;align-items:center}
  .hero h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(52px,8vw,96px);line-height:.9;letter-spacing:2px}
  .hero h1 em{color:var(--accent);font-style:normal;display:block}
  .hero p{color:var(--muted);font-size:14px;line-height:1.7;margin-top:20px;max-width:500px;font-family:'IBM Plex Mono',monospace}
  .stats-box{border:1px solid var(--border);background:var(--surface);padding:24px;display:flex;flex-direction:column;gap:20px}
  .stat{text-align:center}
  .stat-num{font-family:'Bebas Neue',sans-serif;font-size:48px;color:var(--accent);line-height:1;display:block}
  .stat-label{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-top:4px}
  .stat-divider{border:none;border-top:1px solid var(--border)}
  .search-bar{display:flex;margin-bottom:40px}
  .search-bar input{flex:1;background:var(--surface);border:1px solid var(--border);border-right:none;color:var(--text);font-family:'IBM Plex Mono',monospace;font-size:14px;padding:14px 20px;outline:none;transition:border-color .15s}
  .search-bar input:focus{border-color:var(--accent)}
  .search-bar input::placeholder{color:var(--muted)}
  .search-bar select{background:var(--surface);border:1px solid var(--border);border-right:none;color:var(--muted);font-family:'IBM Plex Mono',monospace;font-size:12px;padding:14px 16px;outline:none;cursor:pointer;appearance:none;min-width:140px}
  .search-bar button{background:var(--accent);border:1px solid var(--accent);color:#000;font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:2px;padding:0 32px;cursor:pointer;transition:background .15s}
  .search-bar button:hover{background:#d4eb00}
  .section-header{display:flex;align-items:baseline;justify-content:space-between;margin-bottom:20px}
  .section-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px}
  .section-title span{color:var(--accent);margin-right:10px}
  .section-meta{font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:1px}
  .managers-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1px;background:var(--border);margin-bottom:60px;min-height:200px}
  .manager-card{background:var(--surface);padding:24px;cursor:pointer;transition:background .15s;position:relative;overflow:hidden;animation:fadeIn .3s ease forwards}
  .manager-card:hover{background:var(--surface2)}
  .manager-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px}
  .manager-card.good::before{background:var(--good)}.manager-card.mid::before{background:var(--accent)}.manager-card.bad::before{background:var(--bad)}
  .card-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}
  .manager-name{font-weight:700;font-size:17px;line-height:1.2}
  .manager-role{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-top:4px}
  .score-badge{font-family:'Bebas Neue',sans-serif;font-size:36px;line-height:1;min-width:60px;text-align:right}
  .score-badge.good{color:var(--good)}.score-badge.mid{color:var(--accent)}.score-badge.bad{color:var(--bad)}
  .company-tag{display:inline-block;background:var(--bg);border:1px solid var(--border);font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);padding:3px 8px;letter-spacing:1px;margin-bottom:12px}
  .card-stats{display:flex;gap:20px;margin-bottom:14px}
  .card-stat{font-family:'IBM Plex Mono',monospace;font-size:11px}
  .card-stat strong{display:block;font-size:16px;color:var(--text);margin-bottom:2px}
  .card-stat.complaints strong{color:var(--bad)}.card-stat.commend strong{color:var(--good)}
  .card-stat span{color:var(--muted)}
  .latest-review{border-top:1px solid var(--border);padding-top:12px;font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace;line-height:1.5;font-style:italic}
  .loading{text-align:center;padding:60px;font-family:'IBM Plex Mono',monospace;font-size:13px;color:var(--muted);grid-column:1/-1;letter-spacing:2px}
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;pointer-events:none;transition:opacity .2s}
  .modal-overlay.open{opacity:1;pointer-events:all}
  .modal{background:var(--surface);border:1px solid var(--border);max-width:680px;width:100%;max-height:90vh;overflow-y:auto;transform:translateY(20px);transition:transform .2s}
  .modal-overlay.open .modal{transform:translateY(0)}
  .modal-header{padding:28px 32px 20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:flex-start;position:sticky;top:0;background:var(--surface);z-index:2}
  .modal-close{background:transparent;border:1px solid var(--border);color:var(--muted);font-size:18px;width:32px;height:32px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0}
  .modal-close:hover{border-color:var(--bad);color:var(--bad)}
  .modal-body{padding:28px 32px}
  .modal-score-display{display:flex;align-items:center;gap:24px;margin-bottom:24px;padding:20px;background:var(--bg);border:1px solid var(--border)}
  .big-score{font-family:'Bebas Neue',sans-serif;font-size:80px;line-height:1}
  .big-score.good{color:var(--good)}.big-score.mid{color:var(--accent)}.big-score.bad{color:var(--bad)}
  .score-bar-wrap{margin-bottom:8px}
  .score-bar-label{display:flex;justify-content:space-between;font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:4px;letter-spacing:1px;text-transform:uppercase}
  .score-bar{height:6px;background:var(--border);overflow:hidden}
  .score-bar-fill{height:100%;transition:width .5s ease}
  .review-item{border:1px solid var(--border);padding:16px;margin-bottom:12px}
  .review-type{display:inline-block;font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;padding:2px 8px;margin-bottom:10px;font-weight:600}
  .review-type.complaint{background:rgba(255,71,71,.15);color:var(--bad);border:1px solid rgba(255,71,71,.3)}
  .review-type.commend{background:rgba(71,255,138,.1);color:var(--good);border:1px solid rgba(71,255,138,.25)}
  .review-text{font-size:13px;line-height:1.65;color:var(--text);margin-bottom:10px}
  .review-meta{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px}
  .submit-section{background:var(--bg);border:1px solid var(--border);padding:24px;margin-top:28px}
  .submit-title{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;margin-bottom:20px}
  .form-row{margin-bottom:14px}
  .form-label{display:block;font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px}
  .form-input,.form-textarea,.form-select{width:100%;background:var(--surface);border:1px solid var(--border);color:var(--text);font-family:'IBM Plex Mono',monospace;font-size:13px;padding:10px 14px;outline:none;transition:border-color .15s}
  .form-input:focus,.form-textarea:focus,.form-select:focus{border-color:var(--accent)}
  .form-textarea{min-height:100px;resize:vertical}
  .type-toggle{display:flex;gap:8px;margin-bottom:14px}
  .type-btn{flex:1;padding:10px;border:1px solid var(--border);background:transparent;font-family:'IBM Plex Mono',monospace;font-size:11px;letter-spacing:1px;text-transform:uppercase;cursor:pointer;color:var(--muted);transition:all .15s}
  .type-btn.complaint.active{background:rgba(255,71,71,.15);border-color:var(--bad);color:var(--bad)}
  .type-btn.commend.active{background:rgba(71,255,138,.1);border-color:var(--good);color:var(--good)}
  .submit-btn{width:100%;background:var(--accent);border:none;color:#000;font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:3px;padding:14px;cursor:pointer;margin-top:16px;transition:background .15s}
  .submit-btn:hover{background:#d4eb00}
  .submit-btn:disabled{opacity:.5;cursor:not-allowed}
  .empty-state{text-align:center;padding:60px 20px;color:var(--muted);font-family:'IBM Plex Mono',monospace;font-size:13px;border:1px dashed var(--border);grid-column:1/-1;line-height:2}
  .empty-state .icon{font-size:40px;margin-bottom:16px;display:block;opacity:.5}
  .rank-row{display:flex;align-items:center;gap:24px;padding:20px;border:1px solid var(--border);margin-bottom:1px;background:var(--surface);cursor:pointer;transition:background .15s}
  .rank-row:hover{background:var(--surface2)}
  .rank-num{font-family:'Bebas Neue',sans-serif;font-size:48px;color:var(--border);min-width:60px;text-align:center}
  .fab{position:fixed;bottom:40px;right:40px;background:var(--accent);color:#000;border:none;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:2px;padding:16px 28px;cursor:pointer;z-index:50;transition:all .15s;box-shadow:0 8px 32px rgba(232,255,71,.3)}
  .fab:hover{background:#d4eb00;transform:translateY(-2px)}
  .toast{position:fixed;bottom:40px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--accent);color:#000;font-family:'IBM Plex Mono',monospace;font-size:13px;font-weight:600;padding:14px 24px;letter-spacing:1px;z-index:300;transition:transform .3s ease}
  .toast.error{background:var(--bad);color:#fff}
  .toast.show{transform:translateX(-50%) translateY(0)}
  ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border)}
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<div class="ticker">
  <span class="ticker-inner">&nbsp;&nbsp;&nbsp;&nbsp;EMPLOYEE REVIEWS ARE ANONYMOUS &bull; YOUR VOICE MATTERS &bull; HOLD MANAGEMENT ACCOUNTABLE &bull; BOSSCHECK â€” POWERED BY FIREBASE &bull; EMPLOYEE REVIEWS ARE ANONYMOUS &bull; YOUR VOICE MATTERS &bull; HOLD MANAGEMENT ACCOUNTABLE &bull; BOSSCHECK â€” POWERED BY FIREBASE &bull;&nbsp;&nbsp;&nbsp;&nbsp;</span>
</div>

<header>
  <div class="logo">BOSS<span>CHECK</span><div class="logo-badge">BETA</div></div>
  <nav>
    <button class="active" onclick="showView('browse')">Browse</button>
    <button onclick="showView('rankings')">Rankings</button>
    <div class="db-indicator"><div class="db-dot" id="db-dot"></div><span id="db-status">Firebase</span></div>
    <button class="primary" onclick="window._openAddManager()">+ Add Manager</button>
  </nav>
</header>

<main id="browse-view">
  <div class="hero">
    <div>
      <h1>RATE YOUR <em>BOSS.</em></h1>
      <p>// Anonymous employee reviews of managers &amp; supervisors. No company too big, no boss too powerful. Accountability starts here.</p>
    </div>
    <div class="stats-box">
      <div class="stat"><span class="stat-num" id="total-managers">â€”</span><div class="stat-label">Managers Listed</div></div>
      <hr class="stat-divider">
      <div class="stat"><span class="stat-num" id="total-reviews">â€”</span><div class="stat-label">Reviews Submitted</div></div>
      <hr class="stat-divider">
      <div class="stat"><span class="stat-num" id="total-companies">â€”</span><div class="stat-label">Companies</div></div>
    </div>
  </div>
  <div class="search-bar">
    <input type="text" id="search-input" placeholder="Search by name, company, or industry..." oninput="debounceSearch()">
    <select id="filter-industry" onchange="applyFilter()">
      <option value="">All Industries</option>
      <option>Retail</option><option>Restaurant</option><option>Healthcare</option><option>Tech</option>
      <option>Finance</option><option>Logistics</option><option>Construction</option><option>Education</option><option>Other</option>
    </select>
    <button onclick="applyFilter()">SEARCH</button>
  </div>
  <div class="section-header">
    <div class="section-title"><span>#</span>MOST REPORTED</div>
    <div class="section-meta" id="result-count">Connecting to Firebaseâ€¦</div>
  </div>
  <div class="managers-grid" id="managers-grid"><div class="loading">Connecting to Firebase ğŸ”¥</div></div>
</main>

<main id="rankings-view" style="display:none;">
  <div style="padding:40px 0 20px">
    <h1 style="font-family:'Bebas Neue',sans-serif;font-size:64px;letter-spacing:2px;margin-bottom:10px">LEADERBOARD</h1>
    <p style="font-family:'IBM Plex Mono',monospace;color:var(--muted);font-size:13px">// Ranked by BossScore â€” live from Firebase Firestore.</p>
  </div>
  <div id="rankings-list" style="margin-top:30px"></div>
</main>

<button class="fab" onclick="window._openAddManager()">+ REPORT A BOSS</button>

<!-- DETAIL MODAL -->
<div class="modal-overlay" id="detail-modal">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div id="modal-name" style="font-size:22px;font-weight:700"></div>
        <div class="manager-role" id="modal-role"></div>
        <div class="company-tag" id="modal-company" style="margin-top:8px"></div>
      </div>
      <button class="modal-close" onclick="closeModal('detail-modal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="modal-score-display">
        <div class="big-score" id="modal-big-score">â€”</div>
        <div style="flex:1">
          <div class="score-bar-wrap">
            <div class="score-bar-label"><span>COMPLAINTS</span><span id="bar-complaints-val">0</span></div>
            <div class="score-bar"><div class="score-bar-fill" id="bar-complaints" style="background:var(--bad);width:0%"></div></div>
          </div>
          <div class="score-bar-wrap">
            <div class="score-bar-label"><span>COMMENDATIONS</span><span id="bar-commend-val">0</span></div>
            <div class="score-bar"><div class="score-bar-fill" id="bar-commend" style="background:var(--good);width:0%"></div></div>
          </div>
          <div style="margin-top:12px;font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px">TOTAL REVIEWS: <strong id="modal-total-reviews" style="color:var(--text)">0</strong></div>
        </div>
      </div>
      <div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:2px;margin-bottom:16px">EMPLOYEE REVIEWS</div>
        <div id="modal-reviews"></div>
      </div>
      <div class="submit-section">
        <div class="submit-title">LEAVE A REVIEW</div>
        <div style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px;margin-bottom:16px;text-transform:uppercase">Review type</div>
        <div class="type-toggle">
          <button class="type-btn complaint active" id="type-complaint" onclick="setType('complaint')">âš  File Complaint</button>
          <button class="type-btn commend" id="type-commend" onclick="setType('commend')">âœ“ Commend</button>
        </div>
        <div class="form-row"><label class="form-label">Your Review *</label><textarea class="form-textarea" id="review-text" placeholder="Describe your experience with this manager..."></textarea></div>
        <div class="form-row">
          <label class="form-label">Category</label>
          <select class="form-select" id="review-category">
            <option>Workplace conduct</option><option>Discrimination</option><option>Harassment</option>
            <option>Scheduling issues</option><option>Favoritism</option><option>Communication</option>
            <option>Leadership</option><option>Other</option>
          </select>
        </div>
        <div class="form-row"><label class="form-label">Your Role (optional)</label><input class="form-input" type="text" id="review-role" placeholder="e.g. Cashier, Server, Engineer..."></div>
        <button class="submit-btn" id="review-submit-btn" onclick="window._submitReview()">SUBMIT REVIEW</button>
        <p style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);margin-top:12px;text-align:center">Reviews are anonymous. Never include personally identifying information.</p>
      </div>
    </div>
  </div>
</div>

<!-- ADD MANAGER MODAL -->
<div class="modal-overlay" id="add-modal">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:2px">ADD A MANAGER</div>
        <div style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--muted);margin-top:4px;letter-spacing:1px">Report a manager to the BossCheck database</div>
      </div>
      <button class="modal-close" onclick="closeModal('add-modal')">âœ•</button>
    </div>
    <div style="padding:28px 32px">
      <div class="form-row"><label class="form-label">Manager's Name *</label><input class="form-input" type="text" id="add-name" placeholder="Full name or first name + last initial"></div>
      <div class="form-row"><label class="form-label">Job Title / Role *</label><input class="form-input" type="text" id="add-role" placeholder="e.g. Store Manager, Shift Supervisor"></div>
      <div class="form-row"><label class="form-label">Company / Business Name *</label><input class="form-input" type="text" id="add-company" placeholder="e.g. Target (Springfield, IL)"></div>
      <div class="form-row">
        <label class="form-label">Industry</label>
        <select class="form-select" id="add-industry">
          <option>Retail</option><option>Restaurant</option><option>Healthcare</option><option>Tech</option>
          <option>Finance</option><option>Logistics</option><option>Construction</option><option>Education</option><option>Other</option>
        </select>
      </div>
      <div class="form-row"><label class="form-label">Initial Review *</label><textarea class="form-textarea" id="add-review" placeholder="Write your initial review of this manager..."></textarea></div>
      <div class="form-row">
        <label class="form-label">Review Type</label>
        <div class="type-toggle">
          <button class="type-btn complaint active" id="add-type-complaint" onclick="setAddType('complaint')">âš  Complaint</button>
          <button class="type-btn commend" id="add-type-commend" onclick="setAddType('commend')">âœ“ Commendation</button>
        </div>
      </div>
      <button class="submit-btn" id="add-submit-btn" onclick="window._addManager()">ADD TO DATABASE</button>
      <p style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);margin-top:12px;text-align:center">All submissions are anonymous.</p>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
</body>
</html>
